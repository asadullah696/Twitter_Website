(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{"33Kz":function(e,t,a){"use strict";a.d(t,"b",(function(){return r})),a.d(t,"a",(function(){return s}));a("kYxP");const i=e=>e.getArrayValue("dm_reactions_config_active_reactions"),n=e=>{const t=e.getArrayValue("dm_reactions_config_inactive_reactions");return[...i(e),...t]},r=(e,t)=>{const a=n(t).find((t=>t.endsWith(e)));if(a)return a.split(":")[0]},s=(e,t={includeInactive:!1})=>t.includeInactive?n(e).map((e=>e.split(":")[1])):i(e).map((e=>e.split(":")[1]))},"3AAD":function(e,t,a){"use strict";const i={...a("7n04").a,pinToNewestWhenAtNewest:!0};t.a=i},"4AMG":function(e,t,a){"use strict";a.d(t,"a",(function(){return fr}));var i=a("ejT/"),n=a("ERkP"),r=a.n(n),s=(a("kYxP"),a("gbD7")),o=a("X/yg"),c=a("b9JY");var l=(e,t)=>{if(e&&e.message_data&&t&&t.message_data&&Object(c.b)(e)&&Object(c.b)(t)){const{sender_id:a,time:i}=e.message_data,{sender_id:n,time:r}=t.message_data,s=parseInt(r,10)-parseInt(i,10);return a===n&&s>=0&&s<=6e4}return!1},d=a("jat/"),p=a("MMRb"),u=a("v6aA"),h=a("XnpN"),m=a("LhSm"),b=a("I4+6"),g=a("rHpw"),v=a("PbQQ"),y=a("cm6r"),f=a("jV+4"),_=a("pBrB"),E=a("wCd/");const C=(e,t)=>{const a=Object(h.a)(e,t).map((({user:e})=>e)),i=a&&a[0];return{userDescription:i.description,userEntities:i.entities,userWithheldDescription:i.withheld_description,userWithheldEntities:i.withheld_entities,userFollowerCount:i&&i.followers_count,userFriendsCount:i&&i.friends_count,userIdStr:i&&i.id_str,userJoinDate:i&&i.created_at,userName:i&&i.name,userScreenName:i&&i.screen_name,userIsVerified:i&&i.verified}},S=g.a.create((e=>({root:{flexDirection:"column",alignItems:"center",marginBottom:e.spaces.space16,paddingVertical:e.spaces.space20,paddingHorizontal:e.spaces.space16,borderRadius:e.borderRadii.xSmall},profileInfoItemMargin:{marginBottom:e.spaces.space4},borderBottom:{borderBottomWidth:e.borderWidths.small,borderBottomColor:e.colors.borderColor,borderBottomStyle:"solid"},description:{width:"100%",textAlign:"center"}})));var R=({conversation:e,withBottomBorder:t=!0})=>{const{loggedInUserId:a}=r.a.useContext(u.a);if(!e)return null;const{userDescription:i,userEntities:n,userFollowerCount:s,userFriendsCount:o,userIdStr:c,userIsVerified:l,userJoinDate:d,userName:p,userScreenName:h,userWithheldDescription:R,userWithheldEntities:x}=C(e,a||""),A=!!(p&&h&&(s&&o||d)),w=b.a.generate({color:g.a.theme.colors.text,backgroundColor:g.a.theme.colors.transparent,customFocusBackgroundColor:g.a.theme.colors.gray0,customHoverBackgroundColor:g.a.theme.colors.gray0,customPressedBackgroundColor:g.a.theme.colors.activeFaintGray});return r.a.createElement(v.a.Consumer,null,(e=>r.a.createElement(y.a,{interactiveStyles:w,link:e.withAnchorless(`https://twitter.com/${h||""}`),style:[S.root,t&&A&&S.borderBottom]},r.a.createElement(f.a,{isVerified:l,name:p,screenName:h,style:S.profileInfoItemMargin,weight:"bold",withHoverCard:!0,withLink:!0}),i&&n&&c?r.a.createElement(_.a,{description:i,entities:n,style:[S.profileInfoItemMargin,S.description],userId:c,withheldDescription:R,withheldEntities:x}):null,s&&o?r.a.createElement(E.a,{followersCount:s,friendsCount:o,screenName:h||"",style:S.profileInfoItemMargin,withLink:!1}):null,d?r.a.createElement(m.a,{joinDate:d}):null)))},x=a("V/6K"),A=a("cFyg"),w=a("g54k"),T=a("aA19"),I=a("aWyx"),O=a("mN6z"),M=a("MWbm"),k=a("t62R"),D=a("jhWN"),P=a("MAI/"),L=a("zQEV");const F=({children:e,link:t,style:a})=>r.a.createElement(k.b,{align:"center",color:"gray700",link:t,size:"subtext2",style:a},e);class B extends r.a.Component{constructor(...e){super(...e),this._renderContents=()=>{const{conversation:e,entry:t,entryType:a,perspective:i,users:n}=this.props,s=Object(L.a)(t,a,i,n);switch(a){case I.b.CONVERSATION_AVATAR_UPDATE:{const a=e.avatar_image_https===t.conversation_avatar_image_https;return r.a.createElement(r.a.Fragment,null,this._isValidImageSource(e.avatar_image_https)&&a?r.a.createElement(M.a,{style:N.conversationAvatarContainer},r.a.createElement(T.a,{conversation:e,perspective:i})):null,r.a.createElement(F,null,s))}case I.b.JOIN_CONVERSATION:{const e=this._getAddedYouMessageWithProfileInfo(s),t=this._getParticipantsFromEntry(),a=r.a.createElement(k.b,{align:"center",color:"gray700",size:"subtext2"},this._getParticipantsFromEntryText(t)),i=this._getJoinConversationDetailsWithFacepile(t,a);return r.a.createElement(r.a.Fragment,null,e,i)}default:return r.a.createElement(F,null,s)}},this._getAddedYouMessageWithProfileInfo=e=>{const{entry:t,users:a}=this.props,i=t.sender_id?a[t.sender_id]:void 0,n=i?{pathname:`https://twitter.com/${i.screen_name}`}:void 0;return r.a.createElement(y.a,{interactiveStyles:null,link:n,style:N.userAddedYouContainer},i?r.a.createElement(D.a,{accessibilityLabel:i.screen_name,screenName:i.screen_name,size:"medium",uri:i.profile_image_url_https,withHoverCard:!0,withLink:!0}):null,r.a.createElement(F,{link:n,style:N.userAddedYouText},e))},this._getJoinConversationDetailsWithFacepile=(e,t)=>{const{conversation:a}=this.props,i=e.slice(0,20).map((({profile_image_url_https:e})=>e));return r.a.createElement(y.a,{interactiveStyles:null,link:{pathname:`/messages/${a.conversation_id}/participants`},style:N.joinConversationDetails},t,r.a.createElement(P.a,{style:N.userAvatarFacepile,userAvatarSize:"xLarge",userAvatarUrls:i}))}}shouldComponentUpdate(e){return!Object(O.a)(this.props,e)}render(){return r.a.createElement(M.a,{style:N.root},this._renderContents())}_isValidImageSource(e){return e&&""!==e&&e.indexOf("MEDIA_NOT_FOUND")<0}_getParticipantsFromEntry(){const{entry:e,perspective:t,users:a}=this.props;return e.participants?e.participants.filter((({user_id:e})=>t!==e)).map((({user_id:e})=>a[e])).filter(Boolean):[]}_getParticipantsFromEntryText(e){const{conversation:{conversation_id:t}}=this.props;return Object(L.b)(e.length,t)}}const N=g.a.create((e=>({root:{paddingBottom:e.spaces.space20},conversationAvatarContainer:{alignSelf:"center",height:e.spaces.space64,marginBottom:e.spaces.space12,width:e.spaces.space64},userAddedYouContainer:{flexDirection:"row",justifyContent:"center"},userAddedYouText:{flexShrink:1,marginLeft:e.spaces.space12},joinConversationDetails:{marginTop:e.spaces.space4},userAvatarList:{marginTop:e.spaces.space4},userAvatarFacepile:{marginTop:e.spaces.space4,justifyContent:"center"}})));var j=Object(w.a)(B),U=a("oQhu");var H=Object(U.a)((function(e){const t=g.a.theme.spacesPx.space40;return{DMUserAvatarSizeType:"xLarge",DMUserAvatarSizePx:t,DMUserAvatarSpacerPx:t+g.a.theme.spacesPx.space12}})),W=a("shC7"),V=a("38/B");const z=function(e){return q(e,V.a.reducedMotionEnabled)},q=Object(U.a)((function(e,t){const a=function(){const{DMUserAvatarSizePx:e,DMUserAvatarSpacerPx:t}=H(g.a.theme.scale),a=Q[g.a.theme.scale],i=G/a,n=Y/e,r=Y/2,s=Y-r,o=Y-r-t;return{cssTransition:V.a.reducedMotionEnabled?{}:{transition:`transform ${K}, opacity ${K}`},messageContainer:{base:{transform:[{translateX:0}]},active:{sent:{transform:[{translateX:(W.a.getConstants().isRTL?1:-1)*s}]},received:{transform:[{translateX:(W.a.getConstants().isRTL?-1:1)*o}]}}},actionsContainer:{base:{transform:[{translateX:0}]},active:{sent:{transform:[{translateX:(W.a.getConstants().isRTL?1:-1)*$[g.a.theme.scale]}]},received:{transform:[{translateX:(W.a.getConstants().isRTL?-1:1)*($[g.a.theme.scale]+o)-r}]}}},voiceMessage:{container:{base:{height:a},active:{height:G}},base:{height:a,transform:[{scale:1}]},active:{base:{transform:[{scale:i}]},sent:{paddingRight:r/i,transformOrigin:W.a.getConstants().isRTL?"bottom left":"bottom right"},received:{paddingLeft:r/i,transformOrigin:W.a.getConstants().isRTL?"bottom right":"bottom left"}}},userAvatar:{base:{transform:[{scale:1}]},sent:{transformOrigin:W.a.getConstants().isRTL?"bottom left":"bottom right"},received:{transformOrigin:W.a.getConstants().isRTL?"bottom right":"bottom left"},active:{opacity:1,pointerEvents:"all",transform:[{scale:n}]},visuallyHidden:{opacity:0,pointerEvents:"none"}}}}();return{actionsContainer:function({isSent:e,isVoiceMessageActive:t}){const i=[a.cssTransition,a.actionsContainer.base];return t&&i.push(e?a.actionsContainer.active.sent:a.actionsContainer.active.received),i},messageContainer:function({isSent:e,isVoiceMessageActive:t}){const i=[a.cssTransition,a.messageContainer.base];return t&&i.push(e?a.messageContainer.active.sent:a.messageContainer.active.received),i},voiceMessageContainer:function({isSent:e,isVoiceMessageActive:t}){const i=[a.cssTransition,a.voiceMessage.container.base];return t&&i.push(a.voiceMessage.container.active),i},voiceMessage:function({isSent:e,isVoiceMessageActive:t}){const i=[a.cssTransition,a.voiceMessage.base];return t&&(i.push(a.voiceMessage.active.base),i.push(e?a.voiceMessage.active.sent:a.voiceMessage.active.received)),i},userAvatar:function({isSent:e,isVoiceMessageActive:t}){const i=[a.cssTransition,a.userAvatar.base,e?a.userAvatar.sent:a.userAvatar.received];return t?i.push(a.userAvatar.active):e&&i.push(a.userAvatar.visuallyHidden),i}}}));const G=60,Y=G,Q={xSmall:42,small:42,normal:47,large:47,xLarge:47},$={xSmall:72.26,small:165.61-89.3,normal:158.22-94.4,large:166.64-100.58,xLarge:181.55-111.81},K="0.2s 0s ease-in-out";var X=a("+Kfv"),J=a("hqKg"),Z=a("oEGd"),ee=a("zh9S"),te=a("Yatk"),ae=a("G6rE"),ie=a("P1r1");const ne={scribeAction:ee.c},re=Object(J.createSelector)(((e,t)=>ae.e.select(e,t.senderId)),ie.k,ie.q,((e,t,a)=>({user:Object(te.a)(e),displaySensitiveMedia:t,isDmNsfwMediaFilterEnabled:a})));var se=Object(Z.f)(re,ne),oe=(a("MvUL"),a("1YZw")),ce=a("rxPX"),le=a("0KEI");var de=Object(ce.a)().propsFromActions((()=>({addToast:oe.b,createLocalApiErrorHandler:Object(le.createLocalApiErrorHandlerWithContextFactory)("DIRECT_MESSAGES_OVERFLOW_ACTIONS"),deleteEntry:p.deleteEntry}))).withAnalytics(),pe=a("k49u"),ue=a("LVU8"),he=a("3XMw"),me=a.n(he);const be=me.a.f58dff33,ge=me.a.ad5a8e8e,ve={[pe.a.MissingParameter]:{toast:Object(ue.a)(be)},[pe.a.DirectMessageDestroyPermissionsError]:{toast:{text:ge}},showToast:!0};var ye=a("xCUF"),fe=a("uKEd");const _e=[],Ee=Object(J.createSelector)((e=>Object(fe.l)(e).entries),((e,t)=>Object(fe.p)(e,t.entry.id)||_e),((e,t)=>t.perspective),((e,t,a)=>({selectedReactions:t.filter((t=>{const i=e[t]&&e[t].data;return i&&i.sender_id===a})).map((t=>e[t].data.reaction_key))}))),Ce={createReaction:fe.d,createLocalApiErrorHandler:Object(le.createLocalApiErrorHandlerWithContextFactory)("DIRECT_MESSAGES_REACTIONS_POPOVER"),fetchUpdatesIfNeeded:ye.d,removeReaction:fe.k};var Se=Object(Z.f)(Ee,Ce),Re=a("33Kz"),xe=a("wTX1");var Ae=({accessibilityLabelFormatter:e,count:t,emojiSize:a,emotion:i,enableHoverStyle:n,focusable:s,onPress:o,style:c})=>{const{featureSwitches:l}=r.a.useContext(u.a),d=Object(Re.b)(i,l),p=e&&d?e({emoji:d,count:t}):void 0,h=b.a.generate({backgroundColor:g.a.theme.colors.gray50,color:g.a.theme.colors.gray700});return r.a.createElement(y.a,{accessibilityLabel:p,focusable:s,interactiveStyles:n?h:null,onPress:o,style:[we.container,...c||[]]},r.a.createElement(k.b,{size:a,style:we.unsetLineHeight},d),t?r.a.createElement(xe.a,{color:"gray700",containerStyle:we.count,count:t,size:"subtext3"},t):null)};const we=g.a.create((e=>({container:{flexDirection:"row"},count:{alignSelf:"center",minWidth:e.spaces.space16,paddingLeft:e.spaces.space2},unsetLineHeight:{lineHeight:"unset"}})));var Te=a("pHkl"),Ie=a("Irs7");const Oe=me.a.ca7a2214,Me=me.a.fc0e94b7;class ke extends r.a.Component{constructor(...e){super(...e),this._handleReactionScribing=(e,t)=>{const{analytics:a,entry:i,isGroupDM:n,participantsCount:r}=this.props,s=t?"delete_reaction":"create_reaction",c=Object(o.c)(i);a.scribe({section:"twitter_service",component:"direct_messages",element:s,action:"success",data:{conversation_id:i.conversation_id,conversation_participant_count:r,conversation_type:n?Te.j.GROUP:Te.j.ONE_TO_ONE,message_type:c,reaction_emotion:e}})},this._reactionClickHandler=(e,t)=>()=>{const{createLocalApiErrorHandler:a,createReaction:i,dismiss:n,entry:r,fetchUpdatesIfNeeded:s,perspective:o,removeReaction:c}=this.props,l={reaction_key:e,conversation_id:r.conversation_id,dm_id:r.id,perspective:o};(t?c:i)(l).then(this._handleReactionScribing(e,t)).then((()=>s())).catch(a()),n()}}render(){const{selectedReactions:e}=this.props,t=Object(Re.a)(this.context.featureSwitches).map((t=>{const a=e.includes(t);return r.a.createElement(Ae,{accessibilityLabelFormatter:a?Oe:Me,emojiSize:"title4",emotion:t,enableHoverStyle:!0,focusable:!0,key:t,onPress:this._reactionClickHandler(t,a),style:[Pe.reaction,a&&Pe.selectedReaction]})}));return r.a.createElement(M.a,{style:Pe.reactions},t)}}ke.contextType=u.a;var De=Object(Ie.a)(Se(ke));const Pe=g.a.create((e=>({reactions:{cursor:"pointer",flexDirection:"row",padding:e.spaces.space12},reaction:{borderRadius:e.borderRadii.small,padding:e.spaces.space4},selectedReaction:{backgroundColor:e.colors.gray50}})));var Le=a("OiMc");class Fe extends r.a.Component{constructor(...e){super(...e),this._renderDMReactionPickerContent=e=>{const{entry:t,isGroupDM:a,participantsCount:i,perspective:n}=this.props;return r.a.createElement(De,{dismiss:e,entry:t,isGroupDM:a,participantsCount:i,perspective:n})}}render(){const{children:e,onDismiss:t}=this.props;return r.a.createElement(Le.a,{enableEnterKeyToggle:!0,onDismiss:t,preferredVerticalOrientation:"up",renderContent:this._renderDMReactionPickerContent,withArrow:!0,withFixedPosition:this.context.isDrawer},e)}}Fe.contextType=x.a;var Be=a("TnY3"),Ne=a("mjJ+"),je=a("Q0VY"),Ue=a("eb3s"),He=a("/yvb"),We=a("ZToW"),Ve=a("CaKu"),ze=a("i4Oy"),qe=a("4w6w");const Ge=(e,t)=>{if(null==e)return!1;const[a,i]=t||[0,0];return!((0===a||1===a)&&e.length===i)},Ye=e=>{const{message_data:t}=e;if(!t)return!1;const{attachment:a}=t;if(!a)return!0;if(a.sticker)return!1;const i=a.tweet||a.photo||a.animated_gif||a.video||void 0;if(i)return Ge(t.text,i.indices);if(a.card){var n;const e=((null==(n=t.entities)?void 0:n.urls)||[]).find((e=>e.url===a.card));return Ge(t.text,e&&e.indices)}return!0},Qe=e=>{var t;const a=null==e||null==(t=e.message_data)?void 0:t.attachment;return!(!a||!(a.card||a.tweet||a.photo||a.animated_gif||a.video))},$e=e=>{var t;const a=null==e||null==(t=e.message_data)?void 0:t.attachment;return!(!a||!a.fleet)},Ke=(e,t,a)=>{const i=1.25*g.a.theme.fontSizesPx.body;return{compositeRendered:e?void 0!==t&&void 0!==a:void 0!==t,isTextSquared:void 0!==t&&void 0!==a&&(a===t||a<=t-i),isAttachmentSquared:void 0!==a&&void 0!==t&&(t===a||t<=a-i)}};var Xe=a("hiGS"),Je=a("zIWA"),Ze=a("Lsrn"),et=a("k/Ka");const tt=(e={})=>Object(et.a)("svg",{...e,accessibilityHidden:void 0===e.accessibilityLabel,style:[Ze.a.root,e.style],viewBox:"0 0 24 24"},r.a.createElement("g",null,r.a.createElement("path",{d:"M16.925 9.5H14.5V7.075c0-.414-.336-.75-.75-.75s-.75.336-.75.75V9.5h-2.425c-.414 0-.75.336-.75.75s.336.75.75.75H13v2.425c0 .414.336.75.75.75s.75-.336.75-.75V11h2.425c.414 0 .75-.336.75-.75s-.336-.75-.75-.75zm-.3 11H4.25c-.413 0-.75-.337-.75-.75V8.402c0-.414-.336-.75-.75-.75s-.75.336-.75.75V19.75C2 20.99 3.01 22 4.25 22h12.375c.414 0 .75-.336.75-.75s-.336-.75-.75-.75z"}),r.a.createElement("path",{d:"M19.75 2h-12C6.51 2 5.5 3.01 5.5 4.25v12c0 1.24 1.01 2.25 2.25 2.25h12c1.24 0 2.25-1.01 2.25-2.25v-12C22 3.01 20.99 2 19.75 2zm.75 14.25c0 .413-.337.75-.75.75h-12c-.413 0-.75-.337-.75-.75v-12c0-.413.337-.75.75-.75h12c.413 0 .75.337.75.75v12z"})));tt.metadata={width:24,height:24};var at=tt,it=a("DlVf"),nt=a("ACHU"),rt=a("UgB4"),st=a("fz3c");const ot=me.a.ba60339a,ct=me.a.j4bfee22,lt=me.a.d96cf7cd,dt=me.a.faddd3a2,pt=me.a.eb497e08,ut=me.a.b170974a,ht=me.a.i202bd22,mt=me.a.f2e5491a,bt=me.a.f88553c8,gt=me.a.ifea3114,vt=me.a.cac14829,yt=me.a.h63a5c3b;class ft extends r.a.Component{constructor(e,t){super(e,t),this._renderOverflowMenu=e=>{const{analytics:t,entry:a,featureSwitches:i,isSent:n}=this.props,s=st.a.DMMessage,o=t.contextualScribeNamespace,c=[{text:ot,Icon:Xe.a,isEmphasized:!0,onClick:this._handleShowDeleteConfirmation(e)}];if(!n)if(Object(st.g)(i,s)){var l;const e=Object(st.d)({clientReferer:window.location.pathname,isMedia:!1,isPromoted:!1,reportType:s,reportedConversationId:a.conversation_id,reportedMessageId:a.id,reportedUser:null==(l=a.message_data)?void 0:l.sender_id,scribeNamespace:t.contextualScribeNamespace});c.push({text:ht,Icon:Je.a,link:{pathname:"/i/safety/report_story_start",state:{input:{requested_variant:JSON.stringify(e)}}},onClick:this.props.onReportMessage})}else c.push({text:ht,Icon:Je.a,link:{pathname:`/i/report/${s}/${a.id}`,state:{clientReferer:window.location.pathname,conversationId:a.conversation_id,scribeNamespace:o}},onClick:this.props.onReportMessage});return Ve.a.isAvailable()&&c.push({text:mt,Icon:at,onClick:this._handleCopyMessageText}),r.a.createElement(Ne.a,{isFixed:this.context.isDrawer,items:c,onCloseRequested:this._handleHideActionsAndMenus(e),preferredHorizontalOrientation:"right"})},this._handleCopyMessageText=e=>{const{addToast:t}=this.props,a=this._replaceMessageUrls();a&&(Ve.a.setString(a),t({text:bt})),e&&e()},this._handleForwardButton=()=>{var e,t;const{entry:a,history:i}=this.props;if(null!=a&&null!=(e=a.message_data)&&null!=(t=e.attachment)&&t.tweet){const{tweet:e}=a.message_data.attachment;i.push({pathname:"/messages/compose",state:{tweetAttachment:{...e,id_str:e.status}}})}},this._handleSetActionsActive=()=>{const{setShouldFreezeUpdates:e}=this.props;this.setState({actionsAreActive:!0}),e(!0)},this._handleDelete=()=>{const{analytics:e,createLocalApiErrorHandler:t,deleteEntry:a,entry:i,inboxType:n,isGroupDM:r,participantsCount:s}=this.props,c=Object(o.c)(i);e.scribe({action:"delete",data:{conversation_id:i.conversation_id,conversation_type:r?Te.j.GROUP:Te.j.ONE_TO_ONE,conversation_participant_count:s,message_type:c,inbox_type:Object(o.i)(n)}}),a({conversationId:i.conversation_id,id:i.id}).catch(t(ve))},this._handleHideDeleteConfirmation=()=>{this.setState({showDeleteConfirmation:!1})},this._handleHideActionsAndMenus=e=>()=>{const{setShouldFreezeUpdates:t}=this.props;e&&e(),this.setState({actionsAreActive:!1}),t(!1)},this._handlePressReactionPickerButton=()=>{const{analytics:e,entry:t}=this.props;e.scribe({component:"reaction_button",element:Object(o.c)(t),action:"click"}),this._handleSetActionsActive()},this._handleShowDeleteConfirmation=e=>()=>{const{setShouldFreezeUpdates:t}=this.props;e(),this.setState({actionsAreActive:!1,showDeleteConfirmation:!0}),t(!1)},this._replaceMessageUrls=()=>{const{entry:e}=this.props,t=e&&e.message_data&&e.message_data.entities;let a=e&&e.message_data&&e.message_data.text||"";return je.a.tweetTextParts(a,[0,a.length],t).forEach((e=>{"url"===e.entityType&&(a=a.replace(e.url,e.expandedUrl))})),a},this.state={actionsAreActive:!1,showDeleteConfirmation:!1},this._hasMedia=Qe(this.props.entry),this._isNarrow=ze.a.get("screen").width<g.a.theme.breakpoints.xSmall}render(){var e,t;const{entry:a,isSent:i,shouldShowReactionButton:n,style:s,withVDLRefresh:o}=this.props,c=this._areActionsVisible();return r.a.createElement(M.a,{pointerEvents:c?"auto":"none",style:[Et.messageActions,i?Et.messageActionsLeft:Et.messageActionsRight,c?Et.visible:Et.invisible,o&&Et.vdlMessageActions,this._isNarrow&&(this._hasMedia?Et.messageActionsMediaNarrow:Et.messageActionsNarrow),s]},(null==a||null==(e=a.message_data)||null==(t=e.attachment)?void 0:t.tweet)&&o&&this._renderForwardButton(),n&&this._renderReactionButton(),this._renderOverflowButton(),this._renderDeleteConfirmation())}_renderDeleteConfirmation(){return this.state.showDeleteConfirmation?r.a.createElement(Ue.a,{confirmButtonLabel:lt,confirmButtonType:"destructiveFilled",headline:ct,onCancel:this._handleHideDeleteConfirmation,onConfirm:this._handleDelete,text:dt}):null}_renderForwardButton(){return r.a.createElement(He.a,{accessibilityLabel:gt,hoverLabel:{label:gt},icon:Ct,onPress:this._handleForwardButton,size:this._isNarrow?"small":"medium",type:"brandText"})}_renderReactionButton(){const{entry:e,isGroupDM:t,participantsCount:a,perspective:i,withVDLRefresh:n}=this.props,{actionsAreActive:s}=this.state,o=r.a.createElement(it.a,{style:n?Et.vdlActionIcon:Et.actionIcon});return r.a.createElement(Fe,{entry:e,isGroupDM:t,onDismiss:this._handleHideActionsAndMenus(),participantsCount:a,perspective:i},r.a.createElement(He.a,{accessibilityExpanded:!!s,accessibilityHasPopup:"menu",accessibilityLabel:ut,hoverLabel:{label:vt},icon:o,onPress:this._handlePressReactionPickerButton,size:this._isNarrow?"small":"medium",type:"brandText"}))}_renderOverflowButton(){const{withVDLRefresh:e}=this.props,t=r.a.createElement(nt.a,{style:e?Et.vdlActionIcon:Et.actionIcon});return r.a.createElement(He.a,{accessibilityLabel:pt,hoverLabel:{label:yt},icon:t,onPress:this._handleSetActionsActive,renderMenu:this._renderOverflowMenu,size:this._isNarrow?"small":"medium",type:"brandText"})}_areActionsVisible(){const{containerIsActive:e,containerIsFocused:t,containerIsHovered:a,isDraft:i}=this.props,{actionsAreActive:n}=this.state,r=(s=this.props.entry,!Ye(s)&&Qe(s)&&!We.a.isEnabled);var s;return!i&&(r||e&&!We.a.isEnabled||t||a||n)}}ft.contextType=x.a;var _t=Object(Be.a)(de(ft));const Et=g.a.create((e=>({invisible:{opacity:0},messageActions:{alignSelf:"flex-end",flexDirection:"row"},messageActionsMediaNarrow:{flexDirection:"column"},messageActionsNarrow:{flexShrink:1,flexWrap:"wrap",minWidth:e.spaces.space32},messageActionsLeft:{justifyContent:"flex-end",paddingRight:e.spaces.space4},messageActionsRight:{justifyContent:"flex-start",paddingLeft:e.spaces.space4},vdlMessageActions:{alignSelf:"center"},actionIcon:{color:e.colors.gray700},vdlActionIcon:{color:e.colors.gray600},visible:{opacity:1}}))),Ct=r.a.createElement(rt.a,{style:Et.vdlActionIcon});var St=a("97Jx"),Rt=a.n(St),xt=a("CDB5");var At=Object(ce.a)().propsFromActions((()=>({createLocalApiErrorHandler:Object(le.createLocalApiErrorHandlerWithContextFactory)("DIRECT_MESSAGES_CONVERSATION"),removeEntry:p.removeEntry,sendMessage:xt.m}))).withAnalytics();const wt="87.5%";var Tt=a("wrlS"),It=a("RqPI");const Ot=[],Mt=(e,t)=>Object(fe.p)(e,t.entryId)||Ot,kt=e=>Object(fe.l)(e).entries,Dt={createLocalApiErrorHandler:Object(le.createLocalApiErrorHandlerWithContextFactory)("DIRECT_MESSAGES_REACTIONS")};var Pt=Object(Z.e)((()=>Object(J.createSelector)(kt,Mt,It.r,Tt.d,((e,t,a,i)=>{const n=Object(Re.a)(i,{includeInactive:!0});let r,s=0;return{reactionsWithCounts:t.reduceRight(((t,i)=>{const o=e[i]&&e[i].data;if(!o)return t;if(!n.includes(o.reaction_key))return t;const c=(t.get(o.reaction_key)||0)+1;return t.set(o.reaction_key,c),(null==o?void 0:o.sender_id)===a&&(r=o.reaction_key),s+=1,t}),new Map),selectedReactionKey:r,totalReactionCount:s}}))),Dt);const Lt=[],Ft=(e,t)=>t.entryId,Bt=e=>Object(fe.l)(e).entries,Nt=(e,t)=>Object(fe.p)(e,Ft(0,t))||Lt,jt=(e,t)=>ae.e.selectMany(e,((e,t)=>Object(fe.q)(e,Ft(0,t)))(e,t)),Ut={removeReaction:fe.k,fetchUpdatesIfNeeded:ye.d,createLocalApiErrorHandler:Object(le.createLocalApiErrorHandlerWithContextFactory)("DIRECT_MESSAGES_REACTION_SUMMARY_CONTEXT")};var Ht=Object(Z.e)((()=>Object(J.createSelector)(Bt,Nt,It.r,jt,Tt.d,((e,t,a,i,n)=>{const r=Object(Re.a)(n,{includeInactive:!0}),s=[];t.forEach((t=>{const n=e[t]&&e[t].data;if(!(n&&r.includes(n.reaction_key)))return;const o=i.find((e=>e&&e.id_str===n.sender_id)),c=o&&{avatarUri:o.profile_image_url_https,userId:o.id_str,reactionKey:n.reaction_key,isLoggedInUser:o.id_str===a,screenName:o.screen_name,name:o.name,isProtected:o.protected,isVerified:o.verified,time:n.time};c&&s.push(c)})),s.sort(((e,t)=>t.time-e.time));const o=s.findIndex((e=>e.userId===a));return o>-1&&s.push(...s.splice(0,o)),{loggedInUserId:a,usersWithReactions:s}}))),Ut),Wt=a("TIdA"),Vt=a("htQn");const zt=me.a.gf5e9ea6,qt=me.a.a2d48778,Gt=Wt.a.createLayoutCache();const Yt=g.a.create((e=>({bodyColumn:{flexShrink:1,flexGrow:1,justifyContent:"center",marginHorizontal:e.spaces.space4},body:{alignItems:"center",flexDirection:"row",justifyContent:"space-between"},bottomBorder:{borderBottomColor:e.colors.borderColor,borderBottomStyle:"solid",borderBottomWidth:e.borderWidths.small},column:{alignItems:"center",justifyContent:"center",marginRight:e.spaces.space4},reactionColumn:{alignItems:"center",justifyContent:"center",marginRight:e.componentDimensions.gutterHorizontal},root:{flexDirection:"row",minHeight:"56px",paddingHorizontal:e.componentDimensions.gutterHorizontal,paddingVertical:e.componentDimensions.gutterVertical}})));var Qt=function(e){const{featureSwitches:t}=r.a.useContext(u.a),{onUndoPress:a,renderUndo:i,user:n,withBottomBorder:s}=e,{avatarUri:o,isProtected:c,isVerified:l,name:d,screenName:p}=n,h=r.a.useMemo((()=>function(e){e.stopPropagation(),a()}),[a]),m=r.a.createElement(D.a,{imageLayoutCache:Gt,screenName:p,size:"xxLarge",uri:o}),b=r.a.createElement(Ae,{emojiSize:"title4",emotion:n.reactionKey,focusable:!1}),g=r.a.createElement(f.a,{badgeContext:"content",isProtected:c,isVerified:l,name:d,screenName:p,withHoverCard:!0,withStackedLayout:!0});return r.a.createElement(Vt.a,{link:{pathname:`/${p}`,anchorless:!0},style:[Yt.root,s&&Yt.bottomBorder]},r.a.createElement(M.a,{style:Yt.reactionColumn},b),r.a.createElement(M.a,{style:Yt.column},m),r.a.createElement(M.a,{style:Yt.bodyColumn},r.a.createElement(M.a,{style:Yt.body},g)),i?r.a.createElement(M.a,{style:Yt.column},r.a.createElement(He.a,{accessibilityLabel:qt({emoji:Object(Re.b)(n.reactionKey,t)}),onClick:h,size:"small",type:"brandText"},zt)):null)},$t=a("xKuM"),Kt=a("efqG");const Xt=me.a.b772cd65,Jt=me.a.c0098d49,Zt=me.a.j85999eb;class ea extends r.a.PureComponent{constructor(...e){super(...e),this._renderContent=(e,t)=>r.a.createElement(M.a,null,this._renderHeader(e,t),this._renderUsers(e,t),this._renderDoneButton(e,t)),this._renderHeader=(e,t)=>"sheet"===t?r.a.createElement($t.a,{title:Jt}):r.a.createElement(k.b,{visuallyHidden:!0},Jt),this._renderUsers=(e,t)=>r.a.createElement(M.a,{accessibilityLabel:Zt,style:[ta.container,"sheet"===t?ta.sheet:ta.popover]},this._renderUserCells(e)),this._renderDoneButton=(e,t)=>"sheet"===t&&r.a.createElement(He.a,{key:"button_done",onPress:e,style:ta.cancelButton,type:"primaryOutlined"},Xt),this._renderUserCells=e=>this.props.usersWithReactions.filter(Boolean).map(((t,a)=>r.a.createElement(Qt,{history:this.props.history,key:t.userId,onUndoPress:this._reactionUndoHandler(t.reactionKey,e),renderUndo:t.isLoggedInUser,user:t,withBottomBorder:a!==this.props.usersWithReactions.length-1}))),this._reactionUndoHandler=(e,t)=>()=>{const{conversationId:a,createLocalApiErrorHandler:i,entryId:n,fetchUpdatesIfNeeded:r,loggedInUserId:s,removeReaction:o}=this.props,c={reaction_key:e,conversation_id:a,dm_id:n,perspective:s};t(),o(c).then(this._handleScribeRemoveReaction(e)).then(r).catch(i())},this._handleScribeRemoveReaction=e=>()=>{const{analytics:t}=this.props;t.scribe({page:"app",section:"twitter_service",component:"direct_messages",element:"delete_reaction",action:"success",data:{reaction_emotion:e}})}}render(){const{children:e}=this.props;return r.a.createElement(Kt.a,{renderContent:this._renderContent,withFixedPosition:this.context.isDrawer},e)}}ea.contextType=x.a;const ta=g.a.create((e=>({cancelButton:{marginHorizontal:e.spaces.space12,marginVertical:e.spaces.space12},container:{overflowY:"auto",paddingVertical:e.spaces.space12},popover:{maxHeight:"35vh",minWidth:"320px"},sheet:{maxHeight:"65vh"}})));var aa=Object(Be.a)(Object(Ie.a)(Ht(ea)));const ia=me.a.h95f9e76;class na extends r.a.PureComponent{constructor(e){super(e),this._handleScribeDMReactionSummary=()=>{const{analytics:e}=this.props;e.scribe({component:"dm_reaction_summary",action:"show"})},this._onSetReactionsNode=e=>{this._measureWidths(e||void 0)},this._renderReactions=({isHovered:e})=>{const{reactionsWithCounts:t,selectedReactionKey:a}=this.props,i=this.state.emojiSize||"headline1",n=t.size-1;return Array.from(t,(([t,s],o)=>r.a.createElement(Ae,{count:s,emojiSize:i,emotion:t,enableHoverStyle:!1,focusable:!0,key:t,style:[o===n&&ra.rightPadding,ra.elementPadding,a===t?ra.selfSelect:null,e&&ra.isHoveredDMReaction]})))},this.state={emojiSize:void 0}}render(){const{conversationId:e,entryId:t,isEndOfDM:a,isSent:i,totalReactionCount:n}=this.props,{emojiSize:s}=this.state;if(0===n)return null;const o=b.a.generate({backgroundColor:g.a.theme.colors.gray50,color:g.a.theme.colors.gray700}),c=ia({reactionCount:n});return r.a.createElement(M.a,{style:[ra.container,a?ra.marginShort:ra.marginLong,i?ra.alignRight:ra.alignLeft,s?ra.visible:ra.invisible]},r.a.createElement(aa,{conversationId:e,entryId:t},r.a.createElement(y.a,{accessibilityLabel:c,focusable:!0,interactiveStyles:o,onPress:this._handleScribeDMReactionSummary,ref:this._onSetReactionsNode,style:ra.content},this._renderReactions)))}_measureWidths(e){const t=e&&e.parentElement,a={emojiSize:"headline1"};if(t){const{width:i}=t.getBoundingClientRect(),{width:n=0}=e?e.getBoundingClientRect():{};n>i&&(a.emojiSize="subtext2")}this.setState({...a})}}const ra=g.a.create((e=>({container:{boxSizing:"border-box"},content:{borderRadius:e.borderRadii.infinite,display:"flex",flexDirection:"row"},rightPadding:{paddingRight:e.spaces.space2},elementPadding:{borderColor:e.colors.transparent,borderWidth:e.borderWidths.small,paddingBottom:e.spaces.space2,paddingTop:e.spaces.space2,paddingLeft:`calc(${e.spaces.space2} * 2)`},selfSelect:{borderColor:g.a.theme.colors.gray50,borderRadius:e.borderRadii.infinite},alignLeft:{alignSelf:"flex-start"},alignRight:{alignSelf:"flex-end"},invisible:{opacity:0},visible:{opacity:1},marginShort:{marginBottom:e.spaces.space4},marginLong:{marginBottom:e.spaces.space12},isHoveredDMReaction:{borderColor:e.colors.transparent,cursor:"pointer"}})));var sa=Object(Ie.a)(Pt(na)),oa=a("Xrkv");const ca=me.a.icd0bf34,la=me.a.e8bd8fec,da=me.a.b2d32fad,pa=me.a.a763d33e;class ua extends r.a.PureComponent{constructor(e){super(e),this._handlePress=e=>{e.stopPropagation(),this.setState({showFullList:!0})},this.state={showFullList:!1}}render(){const{isGroupDM:e,isSeenByEveryone:t,namesToDisplay:a}=this.props;return r.a.createElement(M.a,{style:ha.root},r.a.createElement(k.b,{align:"right",color:"gray700",size:"subtext2",style:ha.seenLabel},this._renderSeenLabel()),!t&&e&&a.length?this._renderNameList():null)}_renderSeenLabel(){const{isGroupDM:e,isSeenByEveryone:t,namesToDisplay:a}=this.props;return t?e?da:ca:a.length?pa({count:a.length}):la}_renderNameList(){let{namesToDisplay:e}=this.props;const{showFullList:t}=this.state,a=!t&&e.length>10,i=e.length-10,n=({namesList:e,othersCount:t})=>r.a.createElement(me.a.I18NFormatMessage,{$i18n:"f6464106"},r.a.createElement(k.b,null,e),r.a.createElement(k.b,{color:"link",onPress:this._handlePress},me.a.d7a0722f({othersCount:t})));a&&(e=e.slice(0,10));const s=Object(oa.a)(e,a);return r.a.createElement(k.b,{align:"right",color:"gray700",size:"subtext2",style:ha.namesList},a?r.a.createElement(n,{namesList:s,othersCount:i}):r.a.createElement(k.b,null,s))}}const ha=g.a.create((e=>({root:{alignItems:"flex-end",width:`calc(100% - ${e.spaces.space2})`},seenLabel:{cursor:"pointer"},namesList:{marginBottom:e.spaces.space2,whiteSpace:"pre-line"}})));var ma=ua,ba=a("t0aI");const ga=({entryId:e,participants:t,user:a})=>{const i=va({entryId:e,participants:t,user:a});return{namesToDisplay:i,isSeenByEveryone:i.length===t.length-1}},va=({entryId:e,participants:t,user:a})=>t.reduce(((t,i)=>{const{join_conversation_event_id:n,last_read_event_id:r,user:{name:s}}=i,o=i.user_id!==a.id_str,c=r&&1!==Object(ba.a)(e,r),l=!n||1!==Object(ba.a)(n,e);return o&&c&&l&&t.push(s),t}),[]);var ya=a("IMYl"),fa=a("21zW"),_a=a("gmpV");const Ea=me.a.fad48ee9,Ca=me.a.ba60339a,Sa=me.a.d338f53e,Ra=me.a.ae7d7a24,xa=me.a.d725a288,Aa=me.a.bbe74f3f,wa=me.a.h0e4cdf4,Ta=me.a.bfbc051c;class Ia extends r.a.PureComponent{constructor(...e){super(...e),this._handleRemove=()=>{const{conversationId:e,entryId:t,removeEntry:a}=this.props;a(e,null,{id:t})},this._handleTryAgain=()=>{const{conversationId:e,entryText:t,localMediaId:a,sendMessage:i,user:n}=this.props;i({tweetAttachment:void 0,senderId:n.id_str,conversationId:e,text:t,localMediaId:a}),this._handleRemove()}}render(){const{isSent:e,onPress:t}=this.props,a=this._renderSending(),i=this._renderError(),n=this._renderTimestamp(),s=this._renderReadReceipt(),o=this._renderSentCheckmark(),c=this._renderReactions(),l=n||s||o,d=a||i||c||l,p=this.context.featureSwitches.isTrue("dm_vdl_enabled")&&this.context.featureSwitches.isTrue("dm_vdl_chat_p0_enabled");return d&&r.a.createElement(M.a,{style:[Oa.root,p&&Oa.vdlRootMargin,e&&Oa.sentMessage]},a,i,c,l?r.a.createElement(y.a,{interactiveStyles:null,onPress:t,style:e&&Oa.sentContainer},r.a.createElement(M.a,{style:e&&Oa.groupedItems},n,o),s):null)}_renderError(){const{isError:e}=this.props;return e&&r.a.createElement(M.a,null,r.a.createElement(k.b,{align:"right",color:"gray700",size:"subtext2"},Ra),r.a.createElement(M.a,{style:Oa.groupedItems},r.a.createElement(k.b,{accessibilityRole:"button",color:"magenta500",onPress:this._handleRemove,size:"subtext2",withInteractiveStyling:!0},Ca),r.a.createElement(fa.a,null),r.a.createElement(k.b,{accessibilityRole:"button",color:"primary",onPress:this._handleTryAgain,size:"subtext2",withInteractiveStyling:!0},Sa)))}_renderReactions(){const{conversationId:e,entryId:t,isLastRapidFire:a,isRapidFire:i,isSent:n,withUserAvatar:s}=this.props,o=!i||a;return e?r.a.createElement(M.a,{style:s&&Oa.footerPadderWithAvatar},r.a.createElement(sa,{conversationId:e,entryId:t,isEndOfDM:o,isSent:n})):null}_renderReadReceipt(){const{entryId:e,isActive:t,isDraft:a,isError:i,isGroupDM:n,isSent:s,participants:o,user:c}=this.props;return t&&s&&!a&&!i?r.a.createElement(ma,Rt()({isGroupDM:n},ga({entryId:e,participants:o,user:c}))):null}_renderSending(){const{isDraft:e,isError:t}=this.props;return e&&!t&&r.a.createElement(k.b,{align:"right",color:"gray700",size:"subtext2"},Ea)}_renderSentCheckmark(){const{entryId:e,isDraft:t,isError:a,isLastRapidFire:i,isRapidFire:n,isSent:s,participants:o,user:c}=this.props,{isSeenByEveryone:l}=ga({entryId:e,participants:o,user:c});return!s||t||a||n&&!i?null:r.a.createElement(k.b,{color:l?"primary":"gray700",style:Oa.checkmarkContainer},r.a.createElement(ya.a,{style:Oa.checkmark}))}_renderTimestamp(){const{entryTime:e,isDraft:t,isError:a,isGroupDM:i,isLastRapidFire:n,isRapidFire:s,isSent:o,user:{name:c},withUserAvatar:l}=this.props;if(t||a||s&&!n)return null;const d=new Date(Number(e));let p;p=Object(_a.c)(d)?xa(d):Object(_a.d)(d)?Aa({time:xa(d)}):Object(_a.e)(d)?wa(d):Ta(d);const u=i&&!o,h=o?"right":"left";return r.a.createElement(M.a,{style:[l&&Oa.footerPadderWithAvatar,o&&Oa.timestamp]},r.a.createElement(k.b,{align:h,color:"gray700",size:"subtext2",withInteractiveStyling:o||!We.a.isEnabled},u&&r.a.createElement(me.a.I18NFormatMessage,{$i18n:"c8b914d4"},r.a.createElement(k.b,null,c)),u&&" ",p))}}Ia.contextType=u.a;const Oa=g.a.create((e=>({root:{marginTop:e.spaces.space2,overflow:"hidden",width:wt},vdlRootMargin:{marginTop:`calc(${e.spaces.space8} - ${e.spaces.space2})`},sentMessage:{alignSelf:"flex-end",justifyContent:"flex-end"},sentContainer:{flexDirection:"column"},groupedItems:{justifyContent:"flex-end",flexDirection:"row"},timestamp:{cursor:"pointer"},checkmark:{cursor:"pointer",flexShrink:0,height:"1rem",paddingLeft:e.spaces.space2},checkmarkContainer:{lineHeight:"1"},footerPadderWithAvatar:{marginLeft:`calc(${e.spaces.space40} + ${e.spaces.space12})`}})));var Ma=At(Ia),ka=a("jtO7");const Da=g.a.create((e=>({root:{borderColor:e.colors.gray50,borderStyle:"solid",borderWidth:e.borderWidths.small,borderBottomWidth:e.borderWidths.none,boxSizing:"border-box",overflow:"hidden"},isLast:{borderBottomWidth:e.borderWidths.small},insideTopRoundedSent:{borderTopLeftRadius:e.borderRadii.xLarge},insideTopRoundedReceived:{borderTopRightRadius:e.borderRadii.xLarge},outsideTopRoundedSent:{borderTopRightRadius:e.borderRadii.xLarge},outsideTopRoundedReceived:{borderTopLeftRadius:e.borderRadii.xLarge},sentLast:{borderBottomLeftRadius:e.borderRadii.xLarge},receivedLast:{borderBottomRightRadius:e.borderRadii.xLarge}})));var Pa=({insideTopRounded:e,isLast:t,isSent:a,label:i,onClick:n,outsideTopRounded:s,tcoUrl:o})=>{const c=[Da.root,t&&Da.isLast,t&&a&&Da.sentLast,t&&!a&&Da.receivedLast,e&&a&&Da.insideTopRoundedSent,e&&!a&&Da.insideTopRoundedReceived,s&&a&&Da.outsideTopRoundedSent,s&&!a&&Da.outsideTopRoundedReceived];return r.a.createElement(M.a,{style:c},r.a.createElement(ka.a,{align:"center",color:"primary",label:i,link:o,onClick:n}))},La=a("fs1G");class Fa extends r.a.Component{componentDidMount(){this.props.onImpression()}render(){const{callToActions:e,isSent:t,onCtaClick:a,withSticker:i,withUserText:n}=this.props,s=e.map(((s,o)=>{const c=0===o;return r.a.createElement(Pa,{insideTopRounded:c&&(i||!n),isLast:o===e.length-1,isSent:t,key:o,label:s.label,onClick:a,outsideTopRounded:c&&i,tcoUrl:s.tco_url})}));return r.a.createElement(M.a,null,s)}}Fa.defaultProps={onCtaClick:La.a,onImpression:La.a};var Ba=Fa,Na=a("vjRr"),ja=a("EGrD");const Ua=(e,t)=>t.cardUrl;var Ha=Object(ce.a)().propsFromState((()=>({adFreeArticleDomains:ja.c,card:Na.a.createSingleHydratedSelector(Ua)}))).propsFromActions((()=>({createLocalApiErrorHandler:Object(le.createLocalApiErrorHandlerWithContextFactory)("DM_CARD_MESSAGE"),fetchAdFreeToken:ja.a,loadAdFreeArticleDomainsFromPersistence:ja.b,popOutConversation:p.popOutConversation})));const Wa=g.a.create((e=>({root:{width:"100%"},invisible:{opacity:0},visible:{opacity:1}})));var Va=({attachmentContent:e,attachmentHeader:t,isVisible:a=!0,textContent:i})=>r.a.createElement(M.a,{style:[a?Wa.visible:Wa.invisible,Wa.root]},t,e,i),za=a("cTG8");const qa=({excludeCardUrl:e,isActive:t=!1,isFailedDraft:a,isFirstRapidFire:i=!1,isRapidFire:n=!1,isSent:s,hasAssociatedAttachment:o,messageData:c={},rootStyle:l,tweetId:d,withCta:p,withMediaLinks:h,withMessageBubble:m})=>{const{featureSwitches:v}=r.a.useContext(u.a),f=v.isTrue("dm_vdl_enabled")&&v.isTrue("dm_vdl_chat_p0_enabled"),_=[l,m&&Ga.messageTextContainer,m&&s&&Ga.sent,m&&!s&&Ga.received,a&&Ga.failedDraft,n&&!i&&!s&&Ga.rapidFireReceived,n&&!i&&s&&Ga.rapidFireSent,o&&s&&Ga.hasAssociatedAttachmentSent,o&&!s&&Ga.hasAssociatedAttachmentReceived,m&&f&&s&&Ga.vdlSent,m&&t&&s&&Ga.activeSent,m&&f&&t&&s&&Ga.vdlActiveSent,m&&t&&!s&&!We.a.isEnabled&&Ga.activeReceived,p&&Ga.withCta],E=[Ga.tweetText,m&&Ga.textAlignLeft,!m&&s&&Ga.textAlignRight],{gray0:C,magenta500:S,primary:R,text:x,white:A}=g.a.theme.colors,w=b.a.generate({color:s?A:x,backgroundColor:a?S:s?R:C}),T=c.text&&c.text.length||0;return r.a.createElement(y.a,{accessibilityRole:"none",interactive:s,interactiveStyles:m?w:null,style:_},r.a.createElement(za.a,{color:g.a.isDarkMode()||s?"whiteOnColor":void 0,displayTextRange:[0,T],entities:c.entities,excludeCardUrl:e,linkColor:m&&s||g.a.isDarkMode()?"whiteOnColor":"link",linkify:!0,quotedTweetId:d,size:m?void 0:"title2",style:E,text:c.text||"",underlineLinks:!0,withMediaLinks:h}))},Ga=g.a.create((e=>({tweetText:{overflow:"hidden",wordBreak:"break-word"},messageTextContainer:{borderRadius:e.borderRadii.xLarge,boxSizing:"border-box",maxWidth:"100%",paddingVertical:e.spaces.space12,paddingHorizontal:e.spaces.space16},textAlignLeft:{textAlign:"left"},textAlignRight:{textAlign:"right"},sent:{alignSelf:"flex-end",backgroundColor:e.colors.primary,borderBottomRightRadius:e.borderRadii.none,borderColor:e.colors.primary},received:{alignSelf:"flex-start",backgroundColor:e.colors.dmReceivedBubbleBackground,borderBottomLeftRadius:e.borderRadii.none,borderColor:e.colors.gray200},vdlSent:{backgroundColor:e.colors.blue600},activeSent:{backgroundColor:e.colors.lightPrimary},activeReceived:{backgroundColor:e.colors.gray200},vdlActiveSent:{backgroundColor:e.colors.blue700},failedDraft:{backgroundColor:e.colors.magenta500},rapidFireReceived:{borderTopLeftRadius:e.borderRadii.none},rapidFireSent:{borderTopRightRadius:e.borderRadii.none},withCta:{borderBottomRightRadius:e.borderRadii.none,borderBottomLeftRadius:e.borderRadii.none},hasAssociatedAttachmentSent:{borderTopRightRadius:e.borderRadii.none},hasAssociatedAttachmentReceived:{borderTopLeftRadius:e.borderRadii.none}})));qa.defaultProps={withMediaLinks:!1};var Ya=qa;var Qa=({isActive:e=!1,isFailedDraft:t,isFirstRapidFire:a=!1,isRapidFire:i=!1,isSent:n,messageData:s,withCta:o,withMessageBubble:c})=>r.a.createElement(Ya,{isActive:e,isFailedDraft:t,isFirstRapidFire:a,isRapidFire:i,isSent:n,messageData:s,withCta:o,withMediaLinks:!0,withMessageBubble:c}),$a=a("LSr9"),Ka=a("aX4+"),Xa=a("/Ikv");const{CardNames:Ja}=Xa.a;class Za extends r.a.Component{constructor(...e){var t;super(...e),this.state={attachmentWidth:void 0,textContentWidth:void 0},this._hasClaimsForAdFreeArticles=null==(t=this.context.userClaims)?void 0:t.isTrueAndEnabled("subscriptions_feature_1006"),this._handleAttachmentLayout=e=>{const{nativeEvent:{layout:{width:t}}}=e,{attachmentWidth:a}=this.state;if(a!==t){const e={attachmentWidth:t};this.setState(e)}},this._handleOnClick=e=>{const{card:{binding_values:t}={},conversationId:a,popOutConversation:i}=this.props;if(a&&i(a),this._hasClaimsForAdFreeArticles){const{adFreeArticleDomains:a,createLocalApiErrorHandler:i,fetchAdFreeToken:n}=this.props,[r,s]=new $a.a(n,i()).getAdFreeArticlesClickHandler({destinationUrl:Xa.a.getBindingValue(t,"card_url"),linkDomain:Xa.a.getBindingValue(t,"domain"),adFreeArticleDomains:a});r&&s(e)}},this._handleTextContentLayout=e=>{const{nativeEvent:{layout:{width:t}}}=e,{textContentWidth:a}=this.state;if(a!==t){const e={textContentWidth:t};this.setState(e)}}}componentDidMount(){this._hasClaimsForAdFreeArticles&&this.props.loadAdFreeArticleDomainsFromPersistence()}render(){const{card:e,hasUserText:t,isActive:a,isFailedDraft:i,isFirstRapidFire:n,isRapidFire:s,isSent:o,messageData:c,withCta:l,withMessageBubble:d}=this.props,{attachmentWidth:p,textContentWidth:u}=this.state,h=!!Object.values(Ja).includes(null==e?void 0:e.name),m=Ke(t,p,u),b=m.isAttachmentSquared?"both":o?"right":"left",g=this.context.featureSwitches.isTrue("dm_vdl_enabled")&&this.context.featureSwitches.isTrue("dm_vdl_chat_p0_enabled"),v=e?r.a.createElement(M.a,{onClick:this._handleOnClick,onLayout:this._handleAttachmentLayout},r.a.createElement(Ka.a,{card:{name:e.name,url:e.url,binding_values:e.binding_values,users:e.users},cardContext:{tweetUserId:c.sender_id},dmSentOrReceived:o?"sent":"received",withBorderShadow:g,withSquareBottomBorderRadius:b})):null,y=t?r.a.createElement(M.a,{onLayout:this._handleTextContentLayout,style:o?ei.sentMessageWrapper:ei.receivedMessageWrapper},r.a.createElement(Ya,{excludeCardUrl:null==e?void 0:e.url,hasAssociatedAttachment:!0,isActive:a,isFailedDraft:i,isFirstRapidFire:n,isRapidFire:s,isSent:o,messageData:c,rootStyle:m.isTextSquared?o?ei.textSentSquared:ei.textReceivedSquared:void 0,withCta:l,withMessageBubble:d})):null;return h?r.a.createElement(Va,{attachmentContent:v,isVisible:m.compositeRendered,textContent:y}):r.a.createElement(Qa,{isActive:a,isFailedDraft:i,isFirstRapidFire:n,isRapidFire:s,isSent:o,messageData:c,withCta:l,withMessageBubble:d})}}Za.defaultProps={hasUserText:!1},Za.contextType=u.a;const ei=g.a.create((e=>({attachmentReceivedSquared:{borderBottomRightRadius:e.borderRadii.none},attachmentSentSquared:{borderBottomLeftRadius:e.borderRadii.none},card:{marginBottom:e.spaces.space2},receivedMessageWrapper:{alignSelf:"flex-start"},sentMessageWrapper:{alignSelf:"flex-end"},received:{borderBottomLeftRadius:e.borderRadii.none},sent:{borderBottomRightRadius:e.borderRadii.none},textReceivedSquared:{borderTopRightRadius:e.borderRadii.none},textSentSquared:{borderTopLeftRadius:e.borderRadii.none}})));var ti=Ha(Za);const ai=me.a.f720438f;class ii extends r.a.Component{constructor(...e){super(...e),this.state={attachmentWidth:void 0,textContentWidth:void 0},this._getSquareBottomStyles=e=>{const{isSent:t}=this.props;let a="left";return e?a="both":t&&(a="right"),ni[a]},this._handleAttachmentLayout=e=>{const{nativeEvent:{layout:{width:t}}}=e,{attachmentWidth:a}=this.state;a!==t&&this.setState({attachmentWidth:t})},this._handleTextContentLayout=e=>{const{nativeEvent:{layout:{width:t}}}=e,{textContentWidth:a}=this.state;a!==t&&this.setState({textContentWidth:t})}}render(){const{hasUserText:e,isActive:t,isFailedDraft:a,isFirstRapidFire:i,isRapidFire:n,isSent:s,messageData:o,withCta:c,withMessageBubble:l}=this.props,{attachmentWidth:d,textContentWidth:p}=this.state;if(!o||!o.attachment||!o.attachment.fleet)return null;const{compositeRendered:u,isAttachmentSquared:h,isTextSquared:m}=Ke(e,d,p),b=[ri.tombstoneWrapper,s?ri.sentMessageWrapper:ri.receivedMessageWrapper,this._getSquareBottomStyles(h)],g=r.a.createElement(M.a,{onLayout:this._handleAttachmentLayout,style:b},r.a.createElement(k.b,{color:"gray700"},ai)),v=e?r.a.createElement(M.a,{onLayout:this._handleTextContentLayout,style:[s?ri.sentMessageWrapper:ri.receivedMessageWrapper,!l&&ri.fleetReactionSpacing]},r.a.createElement(Ya,{hasAssociatedAttachment:!0,isActive:t,isFailedDraft:a,isFirstRapidFire:i,isRapidFire:n,isSent:s,messageData:o,rootStyle:m?s?ri.sentSquared:ri.receivedSquared:void 0,withCta:c,withMessageBubble:l})):null;return r.a.createElement(Va,{attachmentContent:g,isVisible:u,textContent:v})}}const ni=g.a.create((e=>({both:{borderBottomRightRadius:e.borderRadii.none,borderBottomLeftRadius:e.borderRadii.none},left:{borderBottomLeftRadius:e.borderRadii.none},right:{borderBottomRightRadius:e.borderRadii.none}}))),ri=g.a.create((e=>({fleetReactionSpacing:{marginTop:e.spaces.space4},receivedMessageWrapper:{alignSelf:"flex-start"},receivedSquared:{borderTopRightRadius:e.borderRadii.none},sentMessageWrapper:{alignSelf:"flex-end"},sentSquared:{borderTopLeftRadius:e.borderRadii.none},tombstoneWrapper:{backgroundColor:e.colors.gray0,borderColor:e.colors.gray50,borderRadius:e.borderRadii.xLarge,boxSizing:"border-box",flexDirection:"row",borderWidth:e.borderWidths.small,paddingHorizontal:e.spaces.space16,paddingVertical:e.spaces.space12,overflow:"auto"}})));var si=ii,oi=(a("849X"),a("prG5")),ci=a("RCZO"),li=a("A91F");const di=me.a.b327c129,pi=e=>{e.stopPropagation()};var ui=({media:e,mediaUrl:t})=>{const a=e.ext_alt_text||di,i=e.media_url_https,{height:n,width:s}=e.original_info||{},o=Object(ci.b)(e).rgb,c=r.a.createElement(oi.a,{accessibilityLabel:a,aspectMode:li.a.withinRange(9/16,10),backgroundColor:o,image:{url:i,width:s,height:n},shouldShowAltLabel:!!e.ext_alt_text});return t?r.a.createElement(y.a,{interactiveStyles:null,link:t,onPress:pi},c):c},hi=a("Modb"),mi=a("lklz"),bi=a("XrEN"),gi=a("ZvMt");var vi=({media:e,messageId:t})=>{const a=e&&bi.a.extractVideoProps(mi.b.forDm(t),e);return a?r.a.createElement(hi.a,Rt()({},a,{aspectRatio:gi.a.getAspectRatio(e.video_info),withPostPlayback:!0})):null},yi=Object(ce.a)().withAnalytics();class fi extends r.a.PureComponent{constructor(e,t){super(e,t),this._handleLayout=e=>{const{nativeEvent:{layout:{width:t}}}=e;this.state.width!==t&&this.setState({width:t})},this._getElement=()=>{const{contentType:e,isSensitive:t}=this.props;return`${t?"sensitive":"untrusted"}_${e}_interstitial`},this._handleClick=()=>{const{analytics:e}=this.props;this.setState({hide:!1}),e.scribe({element:this._getElement(),action:"reveal"})},this.state={hide:!0,width:0}}componentDidMount(){const{analytics:e}=this.props;e.scribe({element:this._getElement(),action:"impression"})}render(){const{children:e,ctaText:t,description:a,withSquareBottomBorderRadius:i}=this.props,{hide:n,width:s}=this.state,o=s<g.a.theme.breakpoints.micro;return n?r.a.createElement(M.a,{focusable:!0,onLayout:this._handleLayout,style:[Ei.root,o?{flexDirection:"column"}:{flexDirection:"row",alignItems:"center"},i&&_i[i]]},r.a.createElement(M.a,{style:Ei.description},r.a.createElement(k.b,null,a)),r.a.createElement(M.a,{style:[Ei.button,o?Ei.breakButtonWrapper:void 0]},r.a.createElement(He.a,{onClick:this._handleClick,size:"small",style:Ei.buttonElement,type:"brandText"},t))):e}}fi.defaultProps={isSensitive:!1};const _i=g.a.create((e=>({both:{borderBottomRightRadius:e.borderRadii.none,borderBottomLeftRadius:e.borderRadii.none},left:{borderBottomLeftRadius:e.borderRadii.none},right:{borderBottomRightRadius:e.borderRadii.none}}))),Ei=g.a.create((e=>({breakButtonWrapper:{marginTop:g.a.theme.spaces.space4,marginLeft:`calc(-1 * ${e.spaces.space12})`},button:{flexGrow:1,alignItems:"flex-start"},buttonElement:{paddingHorizontal:e.spaces.space12},description:{flexGrow:1,flexShrink:1},root:{backgroundColor:e.colors.gray0,borderColor:e.colors.gray50,borderRadius:e.borderRadii.xLarge,boxSizing:"border-box",borderWidth:e.borderWidths.small,maxWidth:"100%",paddingLeft:e.spaces.space16,paddingTop:e.spaces.space16,paddingBottom:e.spaces.space16,paddingRight:e.spaces.space4,overflow:"auto",display:"flex"}})));var Ci=Object(Ie.a)(yi(fi)),Si=a("CoGJ");const Ri=r.a.createElement(Si.a,null),xi=me.a.d9de7b57,Ai=me.a.f2879f4d,wi=me.a.b518221e,Ti=me.a.eeaa9f90,Ii=me.a.g2b43663,Oi=me.a.f277e949;class Mi extends r.a.Component{constructor(...e){super(...e),this.state={attachmentWidth:void 0,textContentWidth:void 0},this._renderAttachment=()=>{const{entry:e,hasUserText:t,isFirstRapidFire:a,isRapidFire:i,isSent:n,isTrusted:s,messageData:c}=this.props,{attachmentWidth:l,textContentWidth:d}=this.state,{attachment:p}=c||{},u=e.is_draft,h=Ke(t,l,d),m=[ki.mediaAttachment,n&&ki.isSent,!n&&ki.received,n&&h.isAttachmentSquared&&ki.equalComponentDimensionsSent,!n&&h.isAttachmentSquared&&ki.equalComponentDimensionsReceived,i&&!a&&n&&ki.rapidFireSent,i&&!a&&!n&&ki.rapidFireReceived];let b,g,v=null;if(!u&&e.conversation_id&&(v=`/messages/${e.conversation_id}/media/${e.id}`),p)if(p.photo)b=p.photo,g=r.a.createElement(ui,{media:b,mediaUrl:v});else if(p.animated_gif)b=p.animated_gif,g=r.a.createElement(vi,{media:b,messageId:e.id});else if(p.video){if(b=p.video,Object(o.l)(p,this.context.featureSwitches))throw new Error("DMMediaMessage should not be used to render voice messages");g=r.a.createElement(vi,{media:b,messageId:e.id})}const y=h.isAttachmentSquared?"both":n?"right":"left",f=b&&g&&(n?g:this._getMediaContentWithGuard(b,s,g,y));return{attachmentContent:r.a.createElement(M.a,{onLayout:this._handleAttachmentLayout,style:m},f),media:b}},this._handleAttachmentLayout=e=>{const{nativeEvent:{layout:{width:t}}}=e,{attachmentWidth:a}=this.state;if(a!==t){const e={attachmentWidth:t};this.setState(e)}},this._handleTextContentLayout=e=>{const{nativeEvent:{layout:{width:t}}}=e,{textContentWidth:a}=this.state;if(a!==t){const e={textContentWidth:t};this.setState(e)}}}render(){const{entry:e,hasUserText:t,isActive:a,isFailedDraft:i,isFirstRapidFire:n,isRapidFire:s,isSent:o,messageData:c,withCta:l,withMessageBubble:d}=this.props,{attachmentWidth:p,textContentWidth:u}=this.state,h=e.is_draft,m=Ke(t,p,u),{attachmentContent:b,media:g}=this._renderAttachment(),v=t?r.a.createElement(M.a,{onLayout:this._handleTextContentLayout,style:o?ki.sentMessageWrapper:ki.receivedMessageWrapper},r.a.createElement(Ya,{hasAssociatedAttachment:!0,isActive:!!a,isFailedDraft:i,isFirstRapidFire:!!n,isRapidFire:!!s,isSent:o,messageData:h?c:this._parseMessageData(c,g),rootStyle:m.isTextSquared?o?ki.sentSquared:ki.receivedSquared:void 0,withCta:l,withMessageBubble:d})):null;return r.a.createElement(Va,{attachmentContent:b,isVisible:m.compositeRendered,textContent:v})}_getMediaContentWithGuard(e,t,a,i){const{displaySensitiveMedia:n,isDmNsfwMediaFilterEnabled:s}=this.props;if(e.possibly_sensitive&&this.context.featureSwitches.isTrue("dm_conversations_nsfw_media_filter_enabled")){if(s){const t="animated_gif"===e.type&&Ii||"video"===e.type&&Ti||wi;return r.a.createElement(Ci,{contentType:e.type,ctaText:t,description:Ai,isSensitive:!0,withSquareBottomBorderRadius:i},a)}}else if(!n&&e.possibly_sensitive)return r.a.createElement(Ci,{contentType:e.type,ctaText:Oi,description:Ri,isSensitive:!0,withSquareBottomBorderRadius:i},a);return t?a:r.a.createElement(Ci,{contentType:e.type,ctaText:Oi,description:xi,withSquareBottomBorderRadius:i},a)}_parseMessageData(e,t){var a;const i=null!=e&&null!=(a=e.entities)&&a.urls&&t?e.entities.urls.filter((e=>e.display_url!==t.display_url)):null;return e&&i?{...e,entities:{...e.entities,urls:i,media:t?[t]:[]}}:void 0}}Mi.contextType=u.a,Mi.defaultProps={hasUserText:!1};const ki=g.a.create((e=>({equalComponentDimensionsSent:{borderBottomLeftRadius:e.borderRadii.none},equalComponentDimensionsReceived:{borderBottomRightRadius:e.borderRadii.none},invisible:{opacity:0},isSent:{borderBottomRightRadius:e.borderRadii.none},mediaAttachment:{borderRadius:e.borderRadii.xLarge,WebkitMaskImage:"url(data:image/png;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICRAEAOw==)"},receivedMessageWrapper:{alignSelf:"flex-start"},sentMessageWrapper:{alignSelf:"flex-end"},rapidFireReceived:{borderTopLeftRadius:e.borderRadii.none},rapidFireSent:{borderTopRightRadius:e.borderRadii.none},received:{borderBottomLeftRadius:e.borderRadii.none},receivedSquared:{borderTopRightRadius:e.borderRadii.none},sentSquared:{borderTopLeftRadius:e.borderRadii.none},visible:{opacity:1}})));var Di=Mi,Pi=Object(ce.a)().propsFromActions((()=>({markSpamStatus:p.markSpamStatus})));const Li=me.a.fd07947f,Fi=me.a.c7a92dc9,Bi=me.a.f277e949,Ni=me.a.fb3ccb55;class ji extends r.a.PureComponent{constructor(...e){super(...e),this._handlePress=e=>()=>{const{conversationId:t,dmId:a,markSpamStatus:i}=this.props;i({conversationId:t,dmId:a,markSpam:e})}}render(){const{children:e}=this.props;return r.a.createElement(Ci,{contentType:"dm",ctaText:Bi,description:Ni},e,this._renderButtons())}_renderButtons(){return r.a.createElement(M.a,{style:Hi.buttons},r.a.createElement(He.a,{onPress:this._handlePress(!1),style:Hi.leftButton,type:"brandOutlined"},Fi),r.a.createElement(He.a,{onPress:this._handlePress(!0),type:"brandOutlined"},Li))}}var Ui=Pi(ji);const Hi=g.a.create((e=>({buttons:{flexDirection:"row",paddingTop:e.spaces.space4},leftButton:{marginRight:e.spaces.space12}})));var Wi=a("U+bB");const Vi=e=>{const t=e.images,a=t.svg||t.size_1x;if(a)return a.url},zi=g.a.create((e=>({stickerItem:{height:`calc(3 * ${e.fontSizes.title2})`,width:`calc(3 * ${e.fontSizes.title2})`}})));var qi=({sticker:e})=>r.a.createElement(Wi.a,{accessibilityLabel:e.display_name,source:Vi(e),style:zi.stickerItem}),Gi=a("XOJV");const Yi=(e,t)=>{var a;const i=null==(a=t.messageData)?void 0:a.attachment;if(i&&i.tweet)return i.tweet.status};var Qi=Object(ce.a)().propsFromState((()=>({tweet:Gi.a.createHydratedTweetSelector(Yi)}))).propsFromActions((()=>({popOutConversation:p.popOutConversation}))),$i=a("b5s6");const Ki=r.a.createElement(k.b,{link:"/settings/safety"});var Xi=e=>r.a.createElement(me.a.I18NFormatMessage,{$i18n:"j3c7dd33"},r.a.cloneElement(Ki,null,me.a.adcf07b5));const Ji=me.a.e4df0ad7,Zi=me.a.f277e949,en=me.a.b5b91d58,tn=me.a.bb594d7b,an=r.a.createElement(Xi,null);const nn=g.a.create((e=>({attachment:{marginBottom:0},receivedMessageWrapper:{alignSelf:"flex-start"},sentMessageWrapper:{alignSelf:"flex-end"},received:{borderBottomLeftRadius:e.borderRadii.none,borderColor:e.colors.gray200},receivedAttachmentSquared:{borderBottomRightRadius:e.borderRadii.none},receivedSquared:{borderTopRightRadius:e.borderRadii.none},sent:{borderBottomRightRadius:e.borderRadii.none,borderColor:e.colors.primary},sentAttachmentSquared:{borderBottomLeftRadius:e.borderRadii.none},sentSquared:{borderTopLeftRadius:e.borderRadii.none}})));var rn=Qi((function(e){const{featureSwitches:t}=r.a.useContext(u.a),{conversationId:a,displaySensitiveMedia:i,hasUserText:n=!1,isActive:s=!1,isDmNsfwMediaFilterEnabled:o,isFailedDraft:c,isFirstRapidFire:l=!1,isRapidFire:d=!1,isSent:p,isTrusted:h,messageData:m,popOutConversation:b,tweet:g,withCta:v,withMessageBubble:y}=e,[f,_]=r.a.useState(void 0),[E,C]=r.a.useState(void 0),S=r.a.useMemo((()=>function(){a&&b(a)}),[a,b]),R=r.a.useMemo((()=>function(e){const{nativeEvent:{layout:{width:t}}}=e;f!==t&&_(t)}),[f]),x=r.a.useMemo((()=>function(e){const{nativeEvent:{layout:{width:t}}}=e;E!==t&&C(t)}),[E]);if(!m||!m.attachment||!m.attachment.tweet)return null;const A=m.attachment.tweet,w=p?"sent":"received",T=Ke(n,f,E),I=r.a.createElement($i.a,{onPress:S,style:[nn[w],n&&nn.attachment,T.isAttachmentSquared?p?nn.sentAttachmentSquared:nn.receivedAttachmentSquared:void 0],tweetId:A.status}),O=T.isAttachmentSquared?"both":p?"right":"left",k=(()=>{if(!g)return null;if(p)return I;if(g.possibly_sensitive&&t.isTrue("dm_conversations_nsfw_media_filter_enabled")){if(o||void 0===o)return r.a.createElement(Ci,{contentType:"photo",ctaText:tn,description:en,withSquareBottomBorderRadius:O},I)}else if(!i&&g.possibly_sensitive)return r.a.createElement(Ci,{contentType:"photo",ctaText:Zi,description:an,withSquareBottomBorderRadius:O},I);return h?I:r.a.createElement(Ci,{contentType:"tweet",ctaText:Zi,description:Ji,withSquareBottomBorderRadius:O},I)})(),D=r.a.createElement(M.a,{onLayout:R,style:nn.attachment},k),P=n?r.a.createElement(M.a,{onLayout:x,style:p?nn.sentMessageWrapper:nn.receivedMessageWrapper},r.a.createElement(Ya,{hasAssociatedAttachment:!0,isActive:s,isFailedDraft:c,isFirstRapidFire:l,isRapidFire:d,isSent:p,messageData:m,rootStyle:T.isTextSquared?p?nn.sentSquared:nn.receivedSquared:void 0,tweetId:A.status,withCta:v,withMediaLinks:!0,withMessageBubble:y})):null;return r.a.createElement(Va,{attachmentContent:D,isVisible:T.compositeRendered,textContent:P})})),sn=a("htvZ"),on=a("MH+I"),cn=a("5Ixf"),ln=a("AtEG");function dn(e){var t,a;const i=r.a.useContext(sn.a),{isLowQuality:n,isSent:s,isTrusted:o}=e;if(null==(t=e.media)||!t.video_info)return null;const[c,l]=i.activeVoiceMessage,[d]=i.playerApi,[p]=i.playerState,{scribeAction:u}=i,[h]=c,m=e.messageId===h;if(!u)return null;const b=un(p),g=(null==(a=e.media)?void 0:a.video_info.duration_millis)||0,v={durationMs:g,isActive:m,isSent:s,playerApi:null,playerState:null,onImpression:()=>u.impression({isLowQuality:n,isTrusted:o}),onPlayRequest:()=>l([e.messageId,e.media]),onPlay:()=>u.play({data:{duration_ms:g}}),onPause:()=>u.pause()};return m&&b&&b.contentId===e.media.id_str&&(v.playerApi=d,v.playerState=p,null!=b&&b.durationMs&&(v.durationMs=null==b?void 0:b.durationMs)),r.a.createElement(pn,v)}function pn(e){const{isActive:t,isSent:a,playerApi:i,playerState:n}=e,s=null==n?void 0:n.isPlaying,o=un(n),c=(null==o?void 0:o.currentTimeMs)||0,l=(null==o?void 0:o.durationMs)||e.durationMs,d=Math.max(t?l-c:l,0);r.a.useLayoutEffect((()=>{e.onImpression()}),[]),r.a.useEffect((()=>{i&&0===c&&(i.play(),e.onPlay())}),[i]);const p=g.a.isDarkMode()||a,u={color:p?"whiteOnColor":"text"},h=[bn.voiceMessage,gn({isSent:a,squared:t}),a?bn.voiceMessageSent:bn.voiceMessageReceived,z(g.a.theme.scale).voiceMessage({isVoiceMessageActive:t,isSent:a})],m=s?cn.a:ln.a;return r.a.createElement(M.a,{style:[bn.container,z(g.a.theme.scale).voiceMessageContainer({isVoiceMessageActive:t,isSent:a})]},r.a.createElement(M.a,{style:h},r.a.createElement(M.a,{style:bn.startSpacer}),r.a.createElement(He.a,{accessibilityLabel:s?mn:hn,icon:r.a.createElement(m,{style:p?bn.iconColorDark:bn.iconColorDefault}),onPress:()=>{i?s?(i.pause(),e.onPause()):(i.play(),e.onPlay()):e.onPlayRequest()},type:"onMediaText"}),r.a.createElement(M.a,{style:bn.durationSpacer}),r.a.createElement(M.a,{style:a?bn.durationOpacity:void 0},r.a.createElement(on.a,Rt()({countdown:!0,timeMs:d},u,{color:"gray700",size:"subtext2",style:a?bn.durationDark:void 0,weight:"bold",withCountdownSymbol:t}))),r.a.createElement(M.a,{style:bn.endSpacer})))}const un=e=>e?e.tracks[e.currentTrackId]:null,hn=me.a.c94b7d89,mn=me.a.eb6f9582,bn=g.a.create((e=>({displayNone:{display:"none"},container:{flexDirection:"row",alignSelf:"flex-end",alignItems:"center",justifyContent:"center"},voiceMessage:{alignSelf:"flex-end",flexDirection:W.a.getConstants().isRTL?"row-reverse":"row",alignItems:"center",justifyContent:"center"},voiceMessageSent:{backgroundColor:e.colors.primary},voiceMessageReceived:{backgroundColor:e.colors.dmReceivedBubbleBackground},durationSpacer:{width:e.spaces.space4},durationOpacity:{opacity:.75},durationDark:{color:e.colors.whiteOnColor},iconColorDark:{color:e.colors.whiteOnColor},iconColorDefault:{color:e.colors.alwaysBaseGray1100},startSpacer:{width:e.spaces.space4},endSpacer:{width:e.spaces.space16}})));function gn({isSent:e,squared:t}){return[vn.base,e?vn.sent:vn.received,t?e?vn.sentSquared:vn.receivedSquared:void 0]}const vn=g.a.create((e=>({base:{borderRadius:e.borderRadii.xLarge,WebkitMaskImage:"url(data:image/png;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICRAEAOw==)"},sent:{borderBottomRightRadius:e.borderRadii.none},sentSquared:{borderTopRightRadius:e.borderRadii.none},received:{borderBottomLeftRadius:e.borderRadii.none},receivedSquared:{borderTopLeftRadius:e.borderRadii.none}})));class yn extends r.a.Component{render(){const{entry:e,isSent:t,onCtaClick:a,onCtaImpression:i}=this.props,{message_data:n}=e,s=n&&n.attachment?n.attachment:{},c=e.marked_as_spam,l=Qe(e),d=!!n&&!!n.ctas,p=Ye(e),u=(e=>{const{message_data:t}=e;if(!t)return!1;if(Qe(e)&&!$e(e))return!1;if(!t.text)return!1;const a=Object(qe.parse)(t.text);if(!a||0===a.length)return!1;const i=a.sort(((e,t)=>t.indices[1]-e.indices[1])).reduce(((e,t)=>`${e.slice(0,t.indices[0])}${e.slice(t.indices[1])}`),t.text).trim();return a.length<=10&&0===i.length})(e),h=!(p&&u),m=$e(e);let b;b=s.sticker?r.a.createElement(qi,{sticker:s.sticker}):this._renderDMMessage(p,d,h);const g=c?r.a.createElement(Ui,{conversationId:e.conversation_id,dmId:e.id},b):b,v=l&&!m&&!Object(o.l)(null==n?void 0:n.attachment,this.context.featureSwitches),y=[t?fn.isSent:fn.isReceived,d&&fn.withCta,v?fn.mediaRoot:fn.flexShrink,this.props.style];return r.a.createElement(M.a,{style:y},g,n&&n.ctas?r.a.createElement(Ba,{callToActions:n.ctas,isSent:t,onCtaClick:a,onImpression:i,withSticker:!!s.sticker||u,withUserText:p}):null)}_renderDMMessage(e,t,a){const{displaySensitiveMedia:i,entry:n,isActive:s,isDmNsfwMediaFilterEnabled:c,isFirstRapidFire:l,isLowQuality:d,isRapidFire:p,isSent:u,isTrusted:h}=this.props,{error:m,message_data:b}=n,g=b&&{...b,entities:b&&b.entities||void 0,error:m},v=null==g?void 0:g.attachment,y={isActive:s,isFailedDraft:!!m,isFirstRapidFire:l,isRapidFire:p,isSent:u,withCta:t,withMessageBubble:a};if(g&&v){if(v.tweet)return r.a.createElement(rn,Rt()({conversationId:n.conversation_id,displaySensitiveMedia:i,hasUserText:e,isDmNsfwMediaFilterEnabled:c,isTrusted:h,messageData:g},y));if(v.photo||v.animated_gif||v.video)return v.video&&Object(o.l)(v,this.context.featureSwitches)?r.a.createElement(dn,{isLowQuality:d,isSent:!!u,isTrusted:h,media:v.video,messageId:n.id}):r.a.createElement(Di,Rt()({displaySensitiveMedia:i,entry:n,hasUserText:e,isDmNsfwMediaFilterEnabled:c,isTrusted:h,messageData:g},y));if(v.card)return r.a.createElement(ti,Rt()({cardUrl:v.card,conversationId:n.conversation_id,hasUserText:e,messageData:g},y));if(v.fleet)return r.a.createElement(si,Rt()({entry:n,hasUserText:e,messageData:g},y))}return r.a.createElement(Qa,Rt()({},y,{messageData:g}))}}yn.contextType=u.a;const fn=g.a.create((e=>({flexShrink:{flexShrink:1},mediaRoot:{flex:1},isSent:{alignItems:"flex-end"},isReceived:{alignItems:"flex-start"},withCta:{alignItems:"stretch"}})));var _n=yn;const En=g.a.create((e=>({avatar:{borderRadius:e.borderRadii.infinite}})));var Cn=({showAvatar:e,size:t="xLarge",user:a})=>e?r.a.createElement(D.a,{accessibilityLabel:a.name,link:{pathname:`/${a.screen_name}`},size:t,uri:a.profile_image_url_https}):r.a.createElement(M.a,{style:[En.avatar,D.a.getSizeStyle(t)]}),Sn=a("B3eJ");function Rn({color:e,isActive:t,size:a,...i}){const n=r.a.useContext(sn.a),[s,o]=r.a.useState(.5),[c]=n.playerState;r.a.useEffect((()=>{t&&c&&c.isPlaying&&o(Math.random())}),[t,c]);const l=t&&(null==c?void 0:c.isPlaying),d=a+2*xn,p=[An.container,i.style,{width:a,height:a}];return r.a.createElement(M.a,{style:p},r.a.createElement(M.a,{style:[An.container,An.transitionOpacity,l?An.show:An.hide]},V.a.reducedMotionEnabled?null:r.a.createElement(Sn.a,{audioLevel:s,color:e,paused:!l,size:a})),r.a.createElement(M.a,{style:[An.border,{width:d,height:d},An.transitionOpacity,t?An.show:An.hide]}))}const xn=parseInt(g.a.theme.spaces.space2,10),An=g.a.create((e=>({container:{alignItems:"center",justifyContent:"center",pointerEvents:"none"},border:{position:"absolute",top:-1*xn,left:-1*xn,backgroundColor:e.colors.navigationBackground,borderRadius:e.borderRadii.infinite},transitionOpacity:{transition:"opacity 0.2s 0s ease-in-out"},hide:{opacity:0},show:{opacity:1}})));var wn=a("uArA"),Tn="messageEntry";const In={element:"cta_dm"},On={viewType:"message"},Mn={isGroupDM:!1,isRapidFire:!1,isFirstRapidFire:!1,isLastRapidFire:!1};class kn extends r.a.Component{constructor(...e){super(...e),this.state={shouldFadeHighlight:!1},this._handleClick=Object(wn.a)((()=>{const{entry:{error:e,id:t,is_draft:a},isActive:i,setActiveEntry:n}=this.props;a||e||(n(i?null:t),this._handleScribeMessageEntryClick())})),this._handleScribeMessageEntryClick=()=>{const{isActive:e}=this.props;if(!We.a.isEnabled&&!e){const{entry:e}=this.props,t={component:"message",element:Object(o.c)(e),action:"click"};this._scribeAction(t)}},this._handleCtaImpression=()=>{this._scribeAction({...In,action:"show"})},this._handleCtaClick=()=>{this._scribeAction({...In,action:"click"})},this._isDMVoiceMessage=()=>{var e;return Object(o.l)(null==(e=this.props.entry.message_data)?void 0:e.attachment,this.context.featureSwitches)}}componentDidMount(){this.props.isHighlightedMessageSearchEntry&&this.setState({shouldFadeHighlight:!0})}shouldComponentUpdate(e,t){return!Object(O.a)(this.props,e)||!Object(O.a)(this.state.shouldFadeHighlight,t.shouldFadeHighlight)}render(){const{isActive:e,isGroupDM:t,isHighlightedMessageSearchEntry:a,isSent:i,user:n}=this.props,s=this._getRapidFireProps(),o=!s.isRapidFire||s.isLastRapidFire,c=this.context.featureSwitches.isTrue("dm_vdl_enabled")&&this.context.featureSwitches.isTrue("dm_vdl_chat_p0_enabled"),l=[Pn.root.base,c&&Pn.root.vdlPadding,o&&Pn.root.contentSpacing,o&&c&&Pn.root.vdlContentSpacing,a&&Pn.root.highlightableEntry,a&&this.state.shouldFadeHighlight&&Pn.root.remove],d=this._isDMVoiceMessage(),p=c?t&&!i:!i||d;if(!n)return null;const u=!We.a.isEnabled||i;return r.a.createElement(X.a,{behavioralEventContext:On},r.a.createElement(M.a,{style:l},r.a.createElement(y.a,{accessibilityExpanded:!(!u||!e),focusable:!0,interactiveStyles:null,onPress:u?this._handleClick:void 0,style:i?Pn.root.sent:Pn.root.received,testID:Tn},(({isFocused:e,isHovered:t})=>this._renderMessage({isFocused:e,isHovered:t,rapidFireProps:s,withVDLRefresh:c,withUserAvatar:p}))),this._renderFooter(s,p)))}_renderMessage({isFocused:e,isHovered:t,rapidFireProps:a,withUserAvatar:i,withVDLRefresh:n}){const{displaySensitiveMedia:s,entry:o,inboxType:c,isActive:l,isDmNsfwMediaFilterEnabled:d,isGroupDM:p,isLowQuality:u,isReadOnly:h,isSent:m,isTrusted:b,isVoiceMessageActive:v,isWide:y,participants:f,perspective:_,scribeVoiceMessage:E,setShouldFreezeUpdates:C}=this.props,{isFirstRapidFire:S,isRapidFire:R}=a,x=[m?Pn.messageContainer.sent:Pn.messageContainer.received,y?Pn.messageContainer.wide:Pn.messageContainer.narrow,m&&y&&Pn.messageContainer.sentWide,!m&&y&&Pn.messageContainer.receivedWide],A=b&&!h,w=this._isDMVoiceMessage(),T=(null==f?void 0:f.length)||0;return r.a.createElement(M.a,{style:x},o.error?null:r.a.createElement(_t,{containerIsActive:l,containerIsFocused:e,containerIsHovered:t,entry:o,featureSwitches:this.context.featureSwitches,inboxType:c,isDraft:!!o.is_draft,isGroupDM:p,isSent:m,onReportMessage:w&&E?()=>E.report({isLowQuality:u,isTrusted:b}):void 0,participantsCount:T,perspective:_,setShouldFreezeUpdates:C,shouldShowReactionButton:A,style:w&&z(g.a.theme.scale).actionsContainer({isSent:m,isVoiceMessageActive:v}),withVDLRefresh:n}),r.a.createElement(_n,{displaySensitiveMedia:s,entry:o,isActive:l,isDmNsfwMediaFilterEnabled:d,isFirstRapidFire:S,isLowQuality:u,isRapidFire:R,isSent:m,isTrusted:b,key:o.id,onCtaClick:this._handleClick,onCtaImpression:this._handleCtaImpression,style:w&&z(g.a.theme.scale).messageContainer({isSent:m,isVoiceMessageActive:v})}),this._possiblyRenderUserAvatar(a,i))}_renderFooter({isLastRapidFire:e,isRapidFire:t},a){var i,n;const{entry:s,isActive:o,isGroupDM:c,isSent:l,participants:d,user:p}=this.props;return p?r.a.createElement(Ma,{conversationId:s.conversation_id,entryId:s.id,entryText:null==(i=s.message_data)?void 0:i.text,entryTime:s.time,isActive:o,isDraft:!!s.is_draft,isError:!!s.error,isGroupDM:c,isLastRapidFire:e,isRapidFire:t,isSent:l,localMediaId:null==(n=s.message_data)?void 0:n.localMediaId,onPress:this._handleClick,participants:d,user:p,withUserAvatar:a}):null}_possiblyRenderUserAvatar({isLastRapidFire:e,isRapidFire:t},a){const{isSent:i,isVoiceMessageActive:n,user:s}=this.props,o=this._isDMVoiceMessage();if(!s||!a&&!n)return null;const{DMUserAvatarSizePx:c,DMUserAvatarSizeType:l}=H(g.a.theme.scale),d={showAvatar:!!o||(!t||!!e),size:l,user:s},p=[Pn.userAvatar.base,i?Pn.userAvatar.sent:Pn.userAvatar.received,o&&z(g.a.theme.scale).userAvatar({isVoiceMessageActive:n,isSent:i})];return r.a.createElement(M.a,{style:Pn.userAvatar.container},i?null:r.a.createElement(M.a,{style:Pn.userAvatar.spacer}),o?r.a.createElement(Rn,{color:i?g.a.theme.colors.primary:g.a.theme.colors.text,isActive:!!n,size:c,style:p}):null,r.a.createElement(M.a,{style:p},r.a.createElement(Cn,d)))}_scribeAction(e){const{analytics:t}=this.props;t.scribe({...e})}_getRapidFireProps(){return{isFirstRapidFire:this.props.isFirstRapidFire,isLastRapidFire:this.props.isLastRapidFire,isRapidFire:this.props.isRapidFire}}}kn.contextType=u.a,kn.defaultProps=Mn;var Dn=Object(Ie.a)(se(function(e){function t(t){const{entry:a}=t,i=r.a.useContext(sn.a),[n]=i.activeVoiceMessage,{scribeAction:s}=i,[o]=n,c=o===a.id,l={...t,isVoiceMessageActive:c,scribeVoiceMessage:s};return r.a.createElement(e,l)}return t.defaultProps=Mn,t}(kn)));const Pn={root:g.a.create((e=>({base:{flexDirection:"column",paddingBottom:e.spaces.space2},vdlPadding:{paddingBottom:"0px"},received:{cursor:"default",alignItems:"flex-start"},sent:{cursor:"pointer",alignItems:"flex-end"},contentSpacing:{paddingBottom:e.spaces.space20},vdlContentSpacing:{paddingBottom:e.spaces.space24},highlightableEntry:{marginHorizontal:`calc(-${e.spaces.space16})`,paddingHorizontal:e.spaces.space16,transition:"background-color 3s ease-in",backgroundColor:e.colors.unreadCellBackground},remove:{backgroundColor:e.colors.cellBackground}}))),messageContainer:g.a.create((e=>({sent:{flexDirection:"row",justifyContent:"flex-end"},received:{flexDirection:"row-reverse",justifyContent:"flex-end"},narrow:{width:"100%"},wide:{width:wt},receivedWide:{paddingRight:e.spaces.space12},sentWide:{paddingLeft:e.spaces.space12}}))),userAvatar:g.a.create((e=>({container:{flexDirection:"row",alignItems:"flex-end"},base:{position:"absolute"},sent:{right:0},received:{left:0},spacer:{width:H(e.scale).DMUserAvatarSpacerPx}})))};var Ln=a("H4nC");const Fn=e=>{const{conversation:t,entry:a,inboxType:i,isActive:n,isFirstRapidFire:s,isHighlightedMessageSearchEntry:o,isLastRapidFire:l,isRapidFire:d,isWide:u,perspective:h,scribeNamespace:m,setActiveEntry:b,setShouldFreezeUpdates:g}=e;if(Object(c.b)(a)||Object(c.e)(a)){const{conversation_id:e,low_quality:c,participants:v,read_only:y,trusted:f,type:_}=t,{message_data:{sender_id:E}={}}=a,C=void 0===e||f;return r.a.createElement(Dn,{entry:a,inboxType:i,isActive:n,isFirstRapidFire:s,isGroupDM:_===p.CONVERSATION_TYPE.GROUP,isHighlightedMessageSearchEntry:o,isLastRapidFire:l,isLowQuality:!!c,isRapidFire:d,isReadOnly:y,isSent:E===h,isTrusted:!!C,isWide:u,participants:v,perspective:h,scribeNamespace:m,senderId:E,setActiveEntry:b,setShouldFreezeUpdates:g})}return Object(c.a)(a)?r.a.createElement(j,{conversation:t,entry:a,entryType:a.type,perspective:h}):Object(c.d)(a)?r.a.createElement(Ln.a,{entry:a,isCompact:!1}):null};var Bn=a("0JOx");const Nn=Object(J.createSelector)(((e,t)=>{const a=Object(fe.o)(e,t.conversationId),i=a&&Object(d.a)(a);return i&&Object(p.selectEntry)(e,i)}),(e=>({lastEntry:e})));var jn=Object(Z.c)(Nn),Un=a("uDfI");const Hn=Object(J.createSelector)(((e,t)=>ae.e.selectMany(e,t.userIds||[])),(e=>({users:e})));var Wn=Object(Un.b)(Hn),Vn=a("VPAj"),zn=a("Enqy"),qn=a("+/1j");const Gn="overflow",Yn=(e,t)=>e.id_str<t.id_str?-1:e.id_str>t.id_str?1:0,Qn={stiffness:1e3,damping:70},$n=140,Kn={scale:Object(zn.spring)(1,Qn),translateY:Object(zn.spring)(0,Qn)},Xn=(e,t)=>({key:e.id_str,data:e,style:Kn}),Jn=Object(Vn.a)({translateY:$n,scale:0}),Zn=Object(Vn.a)({scale:Object(zn.spring)(1,Qn),translateY:Object(zn.spring)($n,Qn)}),er=[{key:"bubble",style:{scale:Object(zn.spring)(1,Qn),translateY:Object(zn.spring)(0,Qn)}}],tr=Object(Vn.a)({translateY:$n,scale:0}),ar=Object(Vn.a)({scale:Object(zn.spring)(1,Qn),translateY:Object(zn.spring)($n,Qn)}),ir=e=>[isFinite(e.scale)&&{scale:e.scale.toFixed(3)},isFinite(e.translateY)&&{translateY:`${Math.round(e.translateY)}%`}].filter(Boolean);class nr extends r.a.Component{constructor(...e){super(...e),this.state={isHidden:!0},this._afterLeave=()=>{const{users:e}=this.props;this.setState((t=>({isHidden:0===e.length})))}}componentDidUpdate(e,t){this.state.isHidden&&this.props.users&&this.props.users.length&&this.setState({isHidden:!1})}shouldComponentUpdate(e,t){return!Object(O.a)(this.props,e)||!Object(O.a)(this.state,t)}render(){const{isHidden:e}=this.state,{users:t}=this.props,a=t.sort(Yn).slice(0,5).map(Xn);return t.length>5&&a.push({key:Gn,style:Kn}),r.a.createElement(M.a,{style:[rr.root,e&&rr.hidden]},r.a.createElement(M.a,{style:rr.avatarRow},r.a.createElement(zn.TransitionMotion,{styles:a,willEnter:Jn,willLeave:Zn},(e=>r.a.createElement(r.a.Fragment,null,e.map(((e,a)=>{if(e.style.scale<=.05)return null;const i=ir(e.style);return e.key===Gn?r.a.createElement(M.a,{key:e.key,style:[rr.avatar,rr.avatarSpacer,rr.overflowAvatar,{transform:i}]},r.a.createElement(qn.a,{style:rr.overflowAvatarText},"+",t.length-5)):r.a.createElement(M.a,{key:e.key,style:[rr.avatar,{transform:i}]},r.a.createElement(D.a,{accessibilityLabel:e.data&&e.data.name,size:"xLarge",uri:e.data&&e.data.profile_image_url_https}))})))))),r.a.createElement(zn.TransitionMotion,{didLeave:this._afterLeave,styles:t.length>0?er:[],willEnter:tr,willLeave:ar},(e=>r.a.createElement(r.a.Fragment,null,e.map((e=>r.a.createElement(M.a,{key:e.key,style:[rr.messageBubble,{transform:ir(e.style)}]},r.a.createElement(M.a,{style:rr.dot}),r.a.createElement(M.a,{style:[rr.dot,rr.dot1]}),r.a.createElement(M.a,{style:[rr.dot,rr.dot2]}))))))))}}const rr=g.a.create((e=>({root:{flexDirection:"row",paddingBottom:e.spaces.space20,paddingRight:e.spaces.space12,width:"calc(100% * 7/8)",position:"relative",transitionProperty:"height, padding-bottom",transitionDuration:"0.2s",overflow:"hidden"},hidden:{paddingBottom:0,paddingRight:0,height:0,width:0},avatarRow:{display:"inline-flex",alignItems:"flex-start",flexDirection:"row"},avatar:{marginEnd:e.spaces.space12,transformOrigin:"50% 100%"},avatarSpacer:{height:e.spaces.space40,width:e.spaces.space40},overflowAvatar:{borderRadius:e.borderRadii.infinite,backgroundColor:e.colors.primary,alignItems:"center",justifyContent:"center"},overflowAvatarText:{color:"white"},messageBubble:{alignItems:"center",borderRadius:e.borderRadii.infinite,maxWidth:"100%",paddingVertical:e.spaces.space12,paddingHorizontal:e.spaces.space16,backgroundColor:e.colors.gray50,borderBottomLeftRadius:e.borderRadii.none,borderColor:e.colors.gray200,flexDirection:"row",height:e.spaces.space40,overflow:"hidden",transformOrigin:"0% 100%"},dot:{display:"flex-inline",position:"relative",width:e.spaces.space12,height:e.spaces.space12,overflow:"hidden",borderRadius:e.borderRadii.infinite,backgroundColor:e.colors.gray700,marginEnd:e.spaces.space4,animationDuration:"1.2s",animationIterationCount:"infinite",animationTimingFunction:"linear",animationKeyframes:[{"15%":{transform:[{scale:1.4}],backgroundColor:e.colors.primary},"30%":{transform:[{scale:1}]}}]},dot1:{animationDelay:"0.1s"},dot2:{animationDelay:"0.2s"}})));var sr=Wn(nr),or=a("tn7R");class cr extends r.a.PureComponent{constructor(...e){super(...e),this._timers={},this.state={forceHide:!1,userIds:[]},this._handleLivePipelineUpdate=e=>{const{user_id:t}=e.dm_typing;t!==this.context.loggedInUserId&&(this._timers[t]&&clearTimeout(this._timers[t]),this._timers[t]=setTimeout((()=>this._removeAvatar(t)),4e3),this.setState((e=>({forceHide:!1,userIds:[...e.userIds.filter((e=>e!==t)),t]}))))},this._removeAvatar=(e,t=!1)=>{this.setState((a=>{const i=a.userIds.filter((t=>t!==e));return{forceHide:t&&0===i.length,userIds:i}}))}}componentDidMount(){this._initializeLivePipeline()}componentDidUpdate(e,t){if(this.props.lastEntry){const{lastEntry:t={}}=e||{},{lastEntry:a}=this.props;t&&t.id!==a.id&&a.message_data&&this._removeAvatar(a.message_data.sender_id,!0)}e.conversationId!==this.props.conversationId&&(this._teardownLivePipeline(),this._initializeLivePipeline())}componentWillUnmount(){this._teardownLivePipeline()}render(){const{forceHide:e,userIds:t}=this.state;return!e&&r.a.createElement(sr,{userIds:t})}_teardownLivePipeline(){Object(or.a)(this._timers).forEach((e=>clearTimeout(e))),this._livePipelineSubscription&&this._livePipelineSubscription.teardown()}_initializeLivePipeline(){const{conversationId:e}=this.props;Object(Bn.h)().then((({LivePipeline:t})=>{t.isSupportedAndReady(this.context.featureSwitches)&&this.context.featureSwitches.isTrue("livepipeline_dm_features_enabled")&&!this._livePipelineSubscription&&(this._livePipelineSubscription=t.get().subscribeTopic(`/dm_typing/${e}`,this._handleLivePipelineUpdate))}))}}cr.contextType=u.a;var lr=jn(cr),dr=a("3AAD"),pr=a("iBK2"),ur=a("RJrc"),hr=a("yw4N"),mr=a("mw9i");const br=me.a.i859a9d3,gr=me.a.i8ecae5b,vr=e=>e.entry.id,yr=e=>e.entry.type===I.b.MESSAGE;class fr extends r.a.Component{constructor(e,t){super(e,t),this._handleScrollEnd=()=>{this.setState({didRenderMessageSearchEntry:!0})},this._renderItem=e=>{const{conversation:t}=this.props,a=t.conversation_id;switch(e.type){case I.b.TYPING_INDICATOR:return a?r.a.createElement(lr,{conversationId:a}):null;case I.b.READ_ONLY_INDICATOR:return a?r.a.createElement(M.a,{style:_r.readOnly},r.a.createElement(k.b,{align:"center",color:"gray700",size:"subtext2"},gr," ",r.a.createElement(k.b,{link:"https://support.twitter.com/articles/14606#faq"},br))):null;case I.b.CONVERSATION_PROFILE_INFO_HEADER:return r.a.createElement(R,{conversation:t});default:return this._renderDMEntry(e)}},this._setActiveEntry=e=>{this.setState({activeEntryId:e})},this._setShouldFreezeUpdates=e=>{this.setState({shouldFreezeUpdates:e})},this.state={activeEntryId:null,didRenderMessageSearchEntry:!1,shouldFreezeUpdates:!1}}shouldComponentUpdate(e,t){return!1===t.shouldFreezeUpdates}render(){const{conversation:e,drawerHeader:t,isWide:a,messageSearchEntryId:n,onForwardRequest:c,onHistoryRequest:u,shouldScrollToCenter:h,style:m}=this.props,{activeEntryId:b}=this.state,g=(({activeEntryId:e,canInjectConversationProfileInfoHeader:t,conversation:a,footer:i,messageSearchEntryId:n,readOnlyEntry:r})=>{const c=a&&a.entries||[],u=null==a?void 0:a.max_search_entry_id,h=null==a?void 0:a.min_search_entry_id,m=(null==a?void 0:a.status)===p.PAGINATION_STATUS.AT_END,b=u?Object(o.d)(c,u):c.length-1,g=h?Object(o.d)(c,h):-1,v=n&&-1===g?Object(o.d)(c,n):g,y=c.slice(m?0:v,b+1),f=(n?y:c).reduce(((i,r,o)=>{t&&0===o&&i.push(s.b);const p=Object(d.a)(i),u=o===c.length-1;if(i.push({isRapidFire:!1,isFirstRapidFire:!1,isLastRapidFire:!1,entry:r,isActive:n===r.id||e===r.id,isTrusted:!(null==a||!a.trusted),messageSearchEntryId:n}),p){const e=l(p.entry,r),t=i[i.length-2];e?(i[i.length-1].isRapidFire=!0,t.isRapidFire||(t.isFirstRapidFire=!0,t.isRapidFire=!0),u&&(i[i.length-1].isLastRapidFire=!0)):t.isRapidFire&&(t.isLastRapidFire=!0)}return i}),[]);return i&&!n&&f.push(i),a.read_only&&r&&!n&&f.push(r),f})({conversation:e,footer:s.d,readOnlyEntry:s.c,canInjectConversationProfileInfoHeader:e.status===I.c.AT_END&&e.type===I.a.ONE_TO_ONE,activeEntryId:b,messageSearchEntryId:n}),v=e.conversation_id,y=e=>{for(let t=e.length-1;t>=0;t--){const a=e[t];if(a&&yr(a))return a}return(e=>e[e.length-1])(e)},f=n?`dm-activity-${v}-${n}`:`dm-activity-${v}`,_=this.state.didRenderMessageSearchEntry&&(null==e?void 0:e.min_search_entry_id)&&e.status!==I.c.AT_END;return r.a.createElement(x.a.Consumer,null,(({isDrawer:s})=>{const o=s?A.b.drawerHeaderRadius:_r.scrollSpace;return r.a.createElement(M.a,{style:[_r.scrollContainer,o]},r.a.createElement(hr.a,{style:[_r.scrollContainer,a&&_r.conversationsPadding,o,m]},t||null,e.status&&e.status!==I.c.AT_END&&!n||_?r.a.createElement(ur.a,null):null,r.a.createElement(mr.a,{style:[_r.content,_r.alignTop],withGutter:!0},r.a.createElement(pr.b,{anchoring:dr.a,assumedItemHeight:50,cacheKey:f,canBeAnchorFunction:yr,centerInitialAnchor:n&&h,hasNewContentAtBottom:!0,identityFunction:vr,initialAnchor:g.length>0?i.a(n&&h?n:vr(y(g))):void 0,items:g,nearStartProximityRatio:2,onAtEnd:n&&this.state.didRenderMessageSearchEntry?c:void 0,onAtStart:n&&this.state.didRenderMessageSearchEntry?u:void 0,onNearStart:n?void 0:u,onScrollEnd:n&&!this.state.didRenderMessageSearchEntry?this._handleScrollEnd:void 0,renderer:this._renderItem,withoutHeadroom:!1})),this.state.didRenderMessageSearchEntry&&n&&e.max_search_entry_id&&e.search_status!==I.c.AT_END?r.a.createElement(ur.a,null):null))}))}_renderDMEntry({entry:e,isActive:t,isFirstRapidFire:a,isLastRapidFire:i,isRapidFire:n}){const{conversation:s,inboxType:o,isWide:c,messageSearchEntryId:l,perspective:d,scribeNamespace:p}=this.props,u=e.id===l;return e&&o?r.a.createElement(Fn,{conversation:s,entry:e,inboxType:o,isActive:t,isFirstRapidFire:a,isHighlightedMessageSearchEntry:u,isLastRapidFire:i,isRapidFire:n,isWide:c,key:e.id,perspective:d,scribeNamespace:p,setActiveEntry:this._setActiveEntry,setShouldFreezeUpdates:this._setShouldFreezeUpdates}):null}}fr.contextType=u.a;const _r=g.a.create((e=>({spinner:{alignItems:"center",marginVertical:"30px"},scrollContainer:{backgroundColor:e.colors.cellBackground,flexGrow:1,height:"100%",overflowX:"hidden",WebkitOverflowScrolling:"touch"},scrollSpace:{paddingTop:e.componentDimensions.appBarHeightPx,marginTop:-e.componentDimensions.appBarHeightPx},conversationsPadding:{paddingTop:e.spaces.space20},content:{flexGrow:1,transform:[{translate3d:"0,0,0"}]},alignTop:{justifyContent:"flex-start"},readOnly:{paddingBottom:e.spaces.space20}})))},"4n2h":function(e,t,a){"use strict";a.d(t,"b",(function(){return i})),a.d(t,"a",(function(){return n}));const i=e=>e?"medium":"normal",n=(e,t)=>e||t?"text":"gray700"},"883S":function(e,t,a){"use strict";a.d(t,"a",(function(){return _})),a.d(t,"c",(function(){return E})),a.d(t,"b",(function(){return C}));var i=a("k49u"),n=a("3XMw"),r=a.n(n),s=a("fs1G");const o=r.a.c3752568,c=r.a.f78aa3e9,l=r.a.f9690dc0,d=r.a.i859a9d3,p=r.a.b1d35407,u=r.a.g539cca6,h=r.a.bbac0019,m=r.a.a1d2a68d,b=r.a.d4f2d9d8,g=r.a.hf383be4,v=r.a.b25c5b2a,y=r.a.c4fdbd16,f=r.a.hf3e7e38,_={[i.a.DirectMessageConversationNotFound]:{customAction:()=>!1}},E={defaultToast:{text:c},showToast:!0},C={defaultToast:{text:o},[i.a.CurrentUserSuspended]:{toast:{text:u,action:{label:d,link:"https://support.twitter.com/articles/15790"}}},[i.a.DirectMessageCannotDmOtherUser]:{toast:{text:l}},[i.a.DirectMessageDuplicate]:{toast:{text:v}},[i.a.DirectMessageOtherUserNotFollowing]:{toast:{text:m,action:{label:d,link:"https://support.twitter.com/articles/14606"}}},[i.a.DirectMessagesSenderBlocksRecipient]:{toast:{text:y}},[i.a.DirectMessageTooLongError]:{toast:{text:h}},[i.a.DirectMessageTweetNotFound]:{toast:{text:b}},[i.a.GenericBadRequest]:{customAction:s.a},[i.a.MessageSendError]:{toast:{text:f}},[i.a.OverStatusUpdateLimit]:{toast:{action:{label:d,link:"https://support.twitter.com/articles/15364"},text:p}},[i.a.TargetUserNotFound]:{toast:{text:g}},showToast:!0}},"8W85":function(e,t,a){"use strict";a("kYxP"),a("ERkP");var i=a("zb92");t.a=Object(i.a)({loader:()=>Promise.all([a.e(23),a.e(170)]).then(a.bind(null,"u2Vg")).then((e=>({default:e.__DANGEROUS_IMPORT__})))})},AQOc:function(e,t,a){"use strict";a.d(t,"b",(function(){return l})),a.d(t,"a",(function(){return d}));a("kYxP");var i=a("lnti"),n=a("aWyx"),r=a("Yatk");const s={entries:{},entryIdsByConversationId:{},reactionsByMessageId:{}},o=(e=[],t={})=>e.map((e=>({...e,user:Object(r.a)(t[e.user_id])||{created_at:"",description:"",entities:{},followed_by:!1,followers_count:0,following:!1,friends_count:0,id:parseInt(e.user_id,10),id_str:e.user_id,name:"",profile_image_url_https:"",protected:!1,screen_name:"",verified:!1}})));function c(e,t){const{entries:a,entryIdsByConversationId:i}=t;return(i[e]||[]).map((e=>a[e]&&a[e].data)).filter(Boolean)}const l=(e,t=s,a)=>{const{conversation_id:i,participants:n,...r}=e;return{conversation_id:i,...r,entries:t.entryIdsByConversationId[i]||[],participants:o(n,a)}},d=(e,t,a)=>{const{conversation_id:s,participants:l,social_proof:d,...p}=e,u={conversation_id:s,...p,entries:c(s,t),participants:o(l,a),social_proof:void 0};return d&&(u.social_proof=((e=[],t={})=>e.map((e=>{if(e.proof_type===n.d.MUTUAL_FRIENDS){const{users:a,...n}=e;return{...n,users:Object(i.a)(a.map((e=>Object(r.a)(t[e]))))}}return e})))(d,a)),u}},GSsg:function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));var i=a("B5iK");class n{constructor(e,t=Object.freeze({})){const{interval:a=6e4,burstInterval:n=3e3,burstDuration:r=3e5}=t;this.pollTimer=new i.b(a).interval(e),this.burstTimer=new i.a(this.pollTimer,n,r)}start(e){return this.pollTimer.start(),e&&this.burstTimer.requestBurst(),this}stop(){return this.burstTimer.stopBurst(),this.pollTimer.stop(),this}restart(){return this.stop(),this.start(),this}}},H4nC:function(e,t,a){"use strict";var i=a("ERkP"),n=a.n(i),r=a("3XMw"),s=a.n(r),o=a("MWbm"),c=a("rHpw"),l=a("t62R"),d=a("4n2h");const p=c.a.create((e=>({root:{paddingBottom:e.spaces.space20}}))),u=s.a.d84b485d,h=s.a.be0c83d7;t.a=({entry:e,isCompact:t,isSelected:a=!1,unread:i=!1})=>{const r="follow"===e.reason?u:h,s=Object(d.b)(i),c=Object(d.a)(i,a);return t?n.a.createElement(l.b,{color:c,weight:s},r):n.a.createElement(o.a,{style:p.root},n.a.createElement(l.b,{align:"center",color:c,size:"subtext2",weight:s},r))}},"I2k/":function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var i=a("k49u"),n=a("lRnM"),r=a("LVU8");const s=e=>({[i.a.ClientNotPermitted]:{customAction:()=>(Object(r.d)("/messages/",{statusCode:401}),Object(n.v)(e))}})},J2UM:function(e,t,a){"use strict";var i=a("0JOx");t.a=()=>Object(i.h)().then((({inputDetect:e})=>e))},OhSZ:function(e,t,a){"use strict";a.d(t,"a",(function(){return f}));a("kYxP");var i=a("ERkP"),n=a.n(i),r=a("MMRb"),s=a("XnpN"),o=a("3XMw"),c=a.n(o),l=a("MWbm"),d=a("jV+4"),p=a("pjBI"),u=a("t62R"),h=a("rHpw"),m=a("p9G8");const b=c.a.cfd94063,g=c.a.b93ba92c,v=(e=[])=>e.map((({data:e})=>e)),y=h.a.create((e=>({title:{maxWidth:"50%"},dmGroup:{display:"flex",flexDirection:"column"}}))),f=({conversation:e,newConversationParticipants:t,perspective:a})=>{if(e){if(e.type===r.CONVERSATION_TYPE.ONE_TO_ONE){const[t]=Object(s.a)(e,a).map((({user:e})=>e));return t.name}return Object(m.a)(e,a)}{const e=v(t);return Object(m.b)(e,a)}};t.b=({conversation:e,isConversationSearchTitle:t=!1,isMessageSearchTitle:a=!1,newConversationParticipants:i,perspective:o,renderTimestamp:c,textColor:h="text",textSize:f,titleWeight:_="bold",withParticipantsCount:E=!1,withScreenName:C=!0,withVDLRefresh:S=!1})=>{if(e){const i=c?c():null;if(e.type===r.CONVERSATION_TYPE.ONE_TO_ONE){const[r]=Object(s.a)(e,o).map((({user:e})=>e)),c=n.a.createElement(d.a,{color:h,isProtected:r.protected,isVerified:r.verified,name:r.name,nameSize:f,screenName:r.screen_name,weight:_,withLink:!1,withScreenName:C});return S&&!t||a?n.a.createElement(p.a,null,c,i):c}{const{participants:r}=e,s=r.length+(S?-1:0);if(t)return n.a.createElement(p.a,{color:h},n.a.createElement(u.b,{color:h,numberOfLines:1,size:f,style:y.title,weight:_},Object(m.a)(e,o,t)),S?null:n.a.createElement(u.b,{color:"gray700",numberOfLines:1,weight:"normal"},b({peopleCount:s})));const c=n.a.createElement(u.b,{color:h,numberOfLines:1,size:f,weight:_},Object(m.a)(e,o,t));return S&&!t||a?n.a.createElement(l.a,{style:y.dmGroup},n.a.createElement(p.a,null,c,i),E&&n.a.createElement(u.b,{color:"gray700",numberOfLines:1,size:f},g({peopleCount:s}))):c}}{const e=v(i);return n.a.createElement(u.b,{color:h,numberOfLines:1,size:f,weight:_},Object(m.b)(e,o))}}},Oi4X:function(e,t,a){"use strict";a("Qavd"),a("MvUL"),a("kYxP");var i=a("ERkP"),n=a.n(i),r=a("0JOx"),s=a("zh9S"),o=a("MMRb"),c=a("CDB5"),l=a("RqPI"),d=a("1YZw"),p=a("hqKg"),u=a("kGix"),h=a("AQOc"),m=a("UhuB"),b=a("pNZL"),g=a("G6rE"),v=a("oEGd"),y=a("X/yg"),f=a("0KEI"),_=a("P1r1");const E=(e,t)=>t.conversationId,C=Object(p.createSelector)(o.selectFetchStatus,((e,t)=>o.selectConversationFetchStatus(e,E(0,t))),((e,t)=>e===u.a.LOADED?t:e)),S=Object(p.createSelector)(((e,t)=>o.selectEntriesForConversation(e,E(0,t))),l.r,((e,t)=>t?Object(y.e)(e,t):void 0)),R=Object(p.createSelector)(((e,t)=>o.selectConversation(e,E(0,t))),o.selectEntries,y.m,l.r,y.n,y.o,g.e.selectAll,C,((e,t)=>c.g(e,E(0,t))),((e,t)=>c.j(e,E(0,t))),((e,t)=>c.i(e,E(0,t))),((e,t)=>c.k(e,E(0,t))),((e,t)=>c.h(e,E(0,t))),((e,t)=>c.l(e,E(0,t))),_.j,m.n,S,_.m,((e,t)=>{const a=E(0,t);return o.selectInboxTypeByConversation(e,a)}),((e,t,a,i,n,r,s,o,c,l,d,p,u,m,b,g,v,y,f)=>{const _=e&&e.data;return{conversation:_&&Object(h.a)(_,t,s)||void 0,dataSaverMode:b,draftText:m,dtabBarInfo:y,fetchStatus:o,gifMetadata:u,inboxType:f,isDmReceiptSettingEnabled:g,cardUrl:c,isNewGroupConversation:a,isUploading:l,media:d,mediaUploadProgress:p,newConversationParticipants:n,perspective:i,quickReplyOptions:v,tweetAttachment:r}}));var x=Object(v.d)(R,(e=>{return{acceptConversation:o.acceptConversation,addMedia:(t=e.conversationId,(e,a)=>c.a(t,e,a)),saveText:c.f,addToast:d.b,addWelcomeMessageToConversation:o.addWelcomeMessageToConversation,cancelUpload:Object(y.a)(e.conversationId),createLocalApiErrorHandler:Object(f.createLocalApiErrorHandlerWithContextFactory)("DIRECT_MESSAGES_CONVERSATION"),fetchConversationFuture:o.fetchConversationFuture,fetchConversationHistoricalSnapshot:o.fetchConversationHistoricalSnapshot,fetchConversationHistory:o.fetchConversationHistory,fetchConversationIfNeeded:o.fetchConversationIfNeeded,fetchInboxIfNeeded:o.fetchInboxIfNeeded,fetchUpdatesIfNeeded:o.fetchUpdatesIfNeeded,googleAnalyticsPageView:s.a,leaveConversation:o.leaveConversation,removeMedia:Object(y.b)(e.conversationId),removeText:c.d,scribeAction:s.c,scribePageImpression:s.d,sendMessage:c.m,updateConversationReadState:o.updateConversationReadState,updateTweetDetailNav:b.b,updateTyping:o.updateTyping,removeConversation:o.removeConversation,popOutConversation:o.popOutConversation};var t})),A=a("I2k/"),w=a("4AMG"),T=a("uB9N"),I=a("htvZ"),O=a("v//M"),M=a("3XMw"),k=a.n(M),D=a("UgB4"),P=a("J2UM"),L=a("07FG"),F=a("I8M8"),B=a("7myi"),N=a("pHkl"),j=a("883S"),U=a("z0MJ"),H=a.n(U),W=a("Es6L"),V=a("LsPn"),z=a("sl05"),q=a("GSsg"),G=a("v6aA"),Y=a("EbOo"),Q=a("rxPX");var $=Object(Q.a)().propsFromActions((()=>({addToast:d.b,block:g.e.block,createLocalApiErrorHandler:Object(f.createLocalApiErrorHandlerWithContextFactory)("UNTRUSTED_CONVERSATION_ACTIONS"),muteDMUser:o.muteDMUser,unmuteDMUser:o.unmuteDMUser,unblock:g.e.unblock}))),K=(a("AQ79"),a("u0B7")),X=a("97Jx"),J=a.n(X),Z=a("tZH3"),ee=a("/yvb"),te=a("efqG");const ae=k.a.ccf2f24e,ie=k.a.ib3fe8a9;var ne=({isGroup:e,onBlockClick:t,onReportClick:a,requestorScreenName:i})=>{const r={type:"destructiveOutlined"},s=n.a.createElement(ee.a,J()({},r,{accessibilityRole:"button"}),ie),o=n.a.createElement(ee.a,J()({},r,{onPress:a}),ae),c=n.a.useCallback(((e,r)=>n.a.createElement(Z.a,{dismiss:e,flatBorders:"sheet"===r,onBlockClick:t,onReportClick:a,requestorScreenName:i,showBlock:!0,showCancel:"sheet"===r})),[t,a,i]);return e?o:n.a.createElement(te.a,{renderContent:c},s)},re=a("MWbm"),se=a("cHvH"),oe=a("rHpw");const ce=e=>{const t=n.a.useContext(G.a),a=t.featureSwitches.isTrue("dm_vdl_enabled")&&t.featureSwitches.isTrue("dm_vdl_chat_p0_enabled"),{loggedInUserId:i}=t,r=()=>e.onAccept(),s=()=>e.onBlock(),o=()=>e.onReport(),c=()=>e.onLeave();return n.a.createElement(se.a,null,(({windowWidth:t})=>{const l=t<=oe.a.theme.breakpoints.small;return n.a.createElement(re.a,{style:le.actionsContainer},a&&n.a.createElement(ee.a,{onPress:r,size:"medium",style:[le.actionFullWidth,le.actionMarginBottom],type:"primaryOutlined"},e.acceptButtonText),n.a.createElement(re.a,{style:l?le.actionFullWidth:[le.actionHalfWidth,le.actionMarginRight]},n.a.createElement(ne,{isGroup:e.isGroup,onBlockClick:s,onReportClick:o,requestorScreenName:Object(y.j)(e.conversation,i).screenName})),n.a.createElement(ee.a,{onPress:c,size:"medium",style:l?[le.actionFullWidth,le.actionMarginTop]:[le.actionHalfWidth,le.actionMarginLeft],type:"destructiveOutlined"},e.declineButtonText),!a&&n.a.createElement(ee.a,{onPress:r,size:"medium",style:[le.actionFullWidth,le.actionMarginTop],type:"primaryOutlined"},e.acceptButtonText))}))},le=oe.a.create((e=>({actionsContainer:{display:"flex",flexWrap:"wrap",flexDirection:"row"},actionFullWidth:{width:"100%"},actionHalfWidth:{width:`calc(50% - ${e.spaces.space4})`},actionMarginRight:{marginRight:e.spaces.space4},actionMarginLeft:{marginLeft:e.spaces.space4},actionMarginTop:{marginTop:e.spaces.space12},actionMarginBottom:{marginBottom:e.spaces.space12}})));var de=a("aITJ"),pe=a("t62R"),ue=a("eb3s"),he=a("vMjK"),me=a("7JQg"),be=a("24HD"),ge=a("zCf4");const ve=k.a.da878dcf,ye=k.a.d96cf7cd,fe=(k.a.gde6b424,k.a.e308019b,k.a.gf5e9ea6,k.a.hc52446b),_e=k.a.f7e1ad65,Ee={headline:k.a.gdf4b79f,text:k.a.bbf83d83,confirmButtonLabel:k.a.bb1d57b6},Ce=oe.a.create((e=>({root:{backgroundColor:e.colors.cellBackground,borderColor:e.colors.borderColor,borderTopStyle:"solid",borderTopWidth:"1px",paddingVertical:e.spaces.space20,paddingHorizontal:e.componentDimensions.gutterHorizontal},copy:{paddingBottom:e.spaces.space20}})));var Se=Object(me.a)({element:"untrusted_interstitial"})($((e=>{const{conversation:t,scribeAction:a,scribeNamespace:i}=e,r=n.a.useContext(G.a),s=Object(ge.f)(),c=Object(ge.g)(),[l,d]=n.a.useState(!1),[p,u]=n.a.useState(!1),h=n.a.useCallback((()=>({items:[{conversation_type:t.type===o.CONVERSATION_TYPE.GROUP?N.j.GROUP:N.j.ONE_TO_ONE}]})),[t.type]),m=n.a.useCallback(((e,t)=>{a({...i,action:e},t||h())}),[h,a,i]);n.a.useEffect((()=>{m("impression")}),[m]);const b=()=>{d(!0),u(!1)},g=()=>{d(!1)},v=()=>{u(!1)},f=()=>{var a;const{conversationId:i,inboxType:n,leaveConversation:r}=e,s=t.type===o.CONVERSATION_TYPE.GROUP?"leave_group":"delete_thread",l=(null==t?void 0:t.participants.length)||0,p=(null==c||null==(a=c.state)?void 0:a.position)||0,u={conversation_type:(null==t?void 0:t.type)===o.CONVERSATION_TYPE.GROUP?N.j.GROUP:N.j.ONE_TO_ONE,conversation_id:i,conversation_participant_count:l,position:p,inbox_type:Object(y.i)(n),entry_point:N.c.REQUEST_ACTION_SHEET};d(!1),r({conversationId:i}),m(s,u),_()},_=()=>{const{inboxType:t}=e;s.push(Object(y.f)(t))},E=()=>{(()=>{var a;const{acceptConversation:i,conversationId:n,inboxType:r,scribeAction:s,scribeNamespace:l}=e,d=(null==t?void 0:t.participants.length)||0,p=(null==c||null==(a=c.state)?void 0:a.position)||0;n&&(i(n),s({...l,action:"accept"},{conversation_id:n,conversation_type:t.type===o.CONVERSATION_TYPE.GROUP?N.j.GROUP:N.j.ONE_TO_ONE,conversation_participant_count:d,entry_point:N.c.REQUEST_ACTION_SHEET,inbox_type:Object(y.i)(r),position:p}))})()},C=t=>()=>{const{addToast:a,block:i,createLocalApiErrorHandler:n}=e;u(!1),i(t).then((()=>{a({action:{label:he.c,onAction:S(t)},text:he.a})}),n(Y.a)),m("block")},S=t=>()=>{const{createLocalApiErrorHandler:a,unblock:i}=e;i(t).catch(a(K.a)),m("unblock")},R=(t&&t.type)===o.CONVERSATION_TYPE.GROUP;return n.a.createElement(n.a.Fragment,null,n.a.createElement(re.a,{style:Ce.root},(e=>{const{loggedInUserId:a}=r;return n.a.createElement(pe.b,{style:Ce.copy},e?fe:_e({senderName:Object(y.j)(t,a).name}))})(R),n.a.createElement(ce,{acceptButtonText:ve,conversation:t,declineButtonText:ye,isGroup:R,onAccept:E,onBlock:()=>{d(!1),u(!0)},onLeave:b,onReport:()=>{const{conversationId:t,inboxType:a}=e;t&&(m("report"),s.push(Object(y.g)(t,window.location.pathname,i,a)))}})),de.b.isKaiOS()?n.a.createElement(V.a,{leftText:ye,onLeftClick:b,onRightClick:E,rightText:ve}):null,l?n.a.createElement(ue.a,{confirmButtonLabel:Ee.confirmButtonLabel,confirmButtonType:"destructiveFilled",headline:Ee.headline,onCancel:g,onConfirm:f,text:Ee.text}):null,p?(()=>{const{loggedInUserId:e}=r,{idStr:a,screenName:i}=Object(y.j)(t,e);return Object(be.j)({confirmation:Object(be.f)(i),onClose:v,handleConfirm:C(a)})})():null)}))),Re=a("yw4N"),xe=a("rFBM"),Ae=a("mw9i"),we=a("jTgF"),Te=a("+d3d"),Ie=a("mN6z");const Oe=n.a.createElement(D.a,null),Me=k.a.badb01a0,ke=k.a.e3275464,De=k.a.d6b11d9c,Pe=k.a.i7ca1446,Le=e=>e&&(e.tweet||e.media),Fe=({gifMetadata:e={},tweetAttachment:t,media:a})=>{let i;return t?i={tweet:t}:a?a.mediaFile?i={media:a}:a.externalMediaDetails&&(i={media:a,provider:e.provider,gifUrl:e.url}):i=null,i};class Be extends n.a.PureComponent{constructor(e,t){super(e,t),this._composer=n.a.createRef(),this._handleLivePipelineUpdate=()=>{this._fetchUpdatesIfNeeded(),this._updatePolling&&this._updatePolling.restart()},this._fetchUpdatesIfNeeded=()=>{const{conversationId:e,createLocalApiErrorHandler:t,fetchUpdatesIfNeeded:a,isDmReceiptSettingEnabled:i}=this.props;a(i?{active_conversation_id:e,dm_users:!0}:{}).catch(t())},this._handleInitialFetch=()=>{this._initialFetch()},this._initialFetch=()=>{const{conversationId:e,createLocalApiErrorHandler:t,fetchInboxIfNeeded:a,fetchUpdatesIfNeeded:i}=this.props;return a().then((()=>{if(e)return this._fetchConversation(e).then((()=>this._requestWelcomeMessage(e)))})).then((()=>i())).catch(t()).finally((()=>{this._updatePolling&&this._updatePolling.start()}))},this._isUntrustedConversation=e=>{const{isNewGroupConversation:t}=this.props;return!(null!=e&&e.trusted||t)},this._leaveConversation=e=>{const{createLocalApiErrorHandler:t,leaveConversation:a}=this.props;a(e).catch(t({showToast:!0}))},this._acceptConversation=e=>{const{acceptConversation:t,createLocalApiErrorHandler:a}=this.props;t(e).then((()=>{de.b.isMobileOS()&&this._fetchConversation(e)})).catch(a({showToast:!0}))},this._renderActions=()=>{const{conversation:e,conversationId:t,inboxType:a,scribeAction:i}=this.props;return e&&this._isUntrustedConversation(e)?e.read_only?null:t&&n.a.createElement(Se,{acceptConversation:this._acceptConversation,conversation:e,conversationId:t,inboxType:a,leaveConversation:this._leaveConversation,scribeAction:i}):n.a.createElement(n.a.Fragment,null,this._renderComposerBar(),de.b.isKaiOS()?n.a.createElement(V.a,{leftText:Pe,onLeftClick:this._handleInfoClick,onRightClick:this._handleComposeClick,rightText:Me}):null)},this._render=()=>{var e,t,a;const{conversation:i,conversationId:r,drawerHeader:s,inboxType:o,isWide:c,location:l,perspective:d,scribeNamespace:p}=this.props,{attachment:u,composerHeight:h}=this.state;return n.a.createElement(I.b,{key:r},n.a.createElement(xe.a,{allowDragDrop:!Le(u),onFilesAdded:this._handleDragDrop,style:z.a.dragDrop},n.a.createElement(Re.a,{style:[z.a.scrollView,!Object(W.a)()&&!this._isUntrustedConversation(i)&&{paddingBottom:h}]},d&&i&&(null==l||null==(e=l.state)||!e.entryPoint||this.state.hasLoadedSnapshot)?n.a.createElement(w.a,{conversation:i,drawerHeader:s,inboxType:o,isWide:c,messageSearchEntryId:null==l||null==(t=l.state)?void 0:t.entryPoint,onForwardRequest:this._handleForwardRequest,onHistoryRequest:null!=l&&null!=(a=l.state)&&a.entryPoint?this._handleRelativeHistoryRequest:this._handleHistoryRequest,perspective:d,scribeNamespace:p,shouldScrollToCenter:this.state.shouldScrollToCenter,style:z.a.activity}):null),this._renderActions()))},this._handleNavHeightChange=e=>{this.setState({composerHeight:`${e}px`})},this._handleTyping=()=>{this._throttleSaveDraftText(),this._throttleUpdateTyping()},this._throttleUpdateTyping=Object(Te.a)((()=>{const{conversationId:e,createLocalApiErrorHandler:t,updateTyping:a}=this.props;e&&a({conversationId:e}).catch(t())}),2e3,{trailing:!1}),this._throttleSaveDraftText=Object(Te.a)((()=>{const{conversationId:e}=this.props;e&&this._handleSaveDraftText()}),1e3,{leading:!1}),this._handleDragDrop=e=>{this._currentComposer&&this._currentComposer.handleAddMediaFiles(e)},this._handleForwardRequest=()=>{const{conversation:e,conversationId:t,createLocalApiErrorHandler:a,fetchConversationFuture:i}=this.props;this.setState({shouldScrollToCenter:!1}),null!=e&&e.max_search_entry_id&&i({conversationId:t}).catch(a())},this._handleHistoryRequest=()=>{const{conversationId:e,createLocalApiErrorHandler:t,fetchConversationHistory:a}=this.props;a({conversationId:e}).catch(t())},this._handleRelativeHistoryRequest=()=>{const{conversationId:e,createLocalApiErrorHandler:t,fetchConversationHistory:a}=this.props;this.setState({shouldScrollToCenter:!1}),a({conversationId:e,isSearch:!0}).catch(t())},this._handleSendMessage=(e,t)=>{var a,i;const{addToast:n,cardUrl:r,conversation:s,conversationId:c,createLocalApiErrorHandler:l,gifMetadata:d,history:p,location:u,newConversationParticipants:h,perspective:m,scribeAction:b,scribeNamespace:g,sendMessage:v,tweetAttachment:y}=this.props,{attachment:f}=this.state,_=f&&f.media,E=null!=s&&s.participants?s.participants.length:0,C=(null==s?void 0:s.type)===o.CONVERSATION_TYPE.GROUP;let S="unknown";if(e.quickReply||_||(this._currentComposer&&this._currentComposer.clear(),this._currentComposer&&this._currentComposer.focus()),d)S="gif";else if(r)S="card";else if(y)S="tweet";else{var R;const e=null==f||null==(R=f.media)?void 0:R.mediaFile,a=null!=e&&e.isVideo?"video":null!=e&&e.isGif?"gif":"photo",i=t?"text":"unknown";S=e?a:i}if(c&&b({...g,element:S,action:"send_dm"},{conversation_id:c,conversation_participant_count:E,conversation_type:C?N.j.GROUP:N.j.ONE_TO_ONE}),this.setState({isSending:!0}),!c){return v({senderId:m,recipients:h&&h.map((({data:e})=>e.id_str)),text:t,tweetAttachment:y}).then((e=>{b({...g,element:S,action:"send_dm"},{conversation_id:e,conversation_participant_count:h?h.length+1:0,conversation_type:N.j.GROUP}),this.setState({attachment:null,isSending:!1}),p.replace(`/messages/${e}`)}),l(j.b)),Promise.resolve()}return!this.state.attachment||null!=(a=this.state.attachment)&&null!=(i=a.media)&&i.uploading||(this.setState({attachment:null}),p.replace(u.pathname)),v({senderId:m,cardUrl:r,conversationId:c,text:t,tweetAttachment:y,...e&&e.quickReply&&{quickReply:e.quickReply}}).then((()=>{!e.quickReply&&_&&(this._currentComposer&&this._currentComposer.clear(),this._currentComposer&&this._currentComposer.focus()),this.setState({isSending:!1})})).catch((e=>{if(this.setState({isSending:!1}),!Object(we.d)(e)||e.code!==F.b.CANCELED)if(Object(we.d)(e)){const t=Object(we.b)(e,De);t&&n(t)}else l(j.b)(e)}))},this._handlePopOutConvo=()=>{const{conversationId:e,popOutConversation:t}=this.props;t(e)},this._handleInfoClick=()=>{const{conversationId:e,history:t}=this.props;e&&t.push(`/messages/${e}/info`)},this._handleComposeClick=()=>{this._currentComposer&&this._currentComposer.focus()},this._handleSaveDraftText=()=>{const{conversationId:e,saveText:t}=this.props;e&&this._currentComposer&&t(e,this._currentComposer.value())},this.state={attachment:Fe(e),composerHeight:oe.a.theme.componentDimensions.appBarHeight,hasLoadedSnapshot:!1,isSending:!1,shouldScrollToCenter:!1}}componentDidMount(){var e,t;const{googleAnalyticsPageView:a,scribeNamespace:i,scribePageImpression:n,updateTweetDetailNav:r}=this.props;return n(i),r(i),a(i),this._initializePolling({interval:3e3}),this._initializeLivePipeline(),this._focusComposerIfNeeded(),null!=(e=this.props.location)&&null!=(t=e.state)&&t.entryPoint&&this.setState({shouldScrollToCenter:!0}),this._initialFetch()}_focusComposerIfNeeded(){H()((()=>Object(P.a)().then((({KEYBOARD:e,MOUSE:t,detectedType:a})=>{const i=this.props.quickReplyOptions;(a(e)||a(t))&&!i&&this._currentComposer&&this._currentComposer.focus()}))))}_initializeLivePipeline(){const{conversationId:e}=this.props;Object(r.h)().then((({LivePipeline:t})=>{e&&t.isSupportedAndReady(this.context.featureSwitches)&&this.context.featureSwitches.isTrue("livepipeline_dm_features_enabled")&&!this._livePipelineSubscription&&(this._livePipelineSubscription=t.get().subscribeTopic(`/dm_update/${e}`,this._handleLivePipelineUpdate),this._initializePolling({interval:1e4}))}))}_initializePolling({interval:e}){this._updatePolling&&this._updatePolling.stop(),this._updatePolling=new q.a(this._fetchUpdatesIfNeeded,{interval:e})}componentWillUnmount(){const{conversation:e,conversationId:t,removeConversation:a}=this.props,i=(null==e?void 0:e.entries)||[];this._updatePolling&&this._updatePolling.stop(),this._updatePolling=void 0,this._livePipelineSubscription&&this._livePipelineSubscription.teardown(),0===i.length&&a(t),1===i.length&&"welcome_message_create"===i[0].type&&a(t)}componentDidUpdate(e,t){var a,i,n;const{conversation:r,conversationId:s,fetchStatus:o,isUploading:c,location:l,quickReplyOptions:d,updateConversationReadState:p}=this.props;var h;((null==l||null==(a=l.state)?void 0:a.entryPoint)!==(null==(i=e.location)||null==(n=i.state)?void 0:n.entryPoint)&&s&&this._fetchConversation(s),s!==e.conversationId)?(s&&this._fetchConversation(s),this._focusComposerIfNeeded(),this._livePipelineSubscription&&this._livePipelineSubscription.teardown(),this._initializeLivePipeline()):((null==r?void 0:r.sort_event_id)!==(null==(h=e.conversation)?void 0:h.sort_event_id)&&p(s),c||!e.isUploading||d||this._currentComposer&&this._currentComposer.focus(),e.fetchStatus===u.a.LOADED&&o!==u.a.LOADED&&s&&this._fetchConversation(s))}UNSAFE_componentWillReceiveProps(e){const{media:t}=this.props,{media:a}=e;Object(Ie.a)(t,a)||this.setState({attachment:Fe(e)})}render(){const{fetchStatus:e}=this.props;return n.a.createElement(Ae.a,{style:[z.a.root,de.b.isKaiOS()&&z.a.kaiOSFix]},n.a.createElement(O.a,{fetchStatus:e,onRequestRetry:this._handleInitialFetch,render:this._render}))}_renderComposerBar(){const{addMedia:e,cardUrl:t,conversation:a,conversationId:i,dataSaverMode:r,draftText:s,dtabBarInfo:o,history:c,isUploading:l,mediaUploadProgress:d,quickReplyOptions:p,removeMedia:u,richTextInputContext:h,scribeNamespace:m,typeaheadWrapper:b}=this.props,{attachment:g,isSending:v}=this.state,y=this.props.prefillText||s;return null!=a&&a.read_only?null:n.a.createElement(T.a,{attachment:g,conversationId:i,disabled:l,dtabBarInfo:o,history:c,isCardPreviewTombstoned:Object(L.a)(t),isSending:v,isUploading:l,key:i,mediaUploadProgress:d,onAddMedia:e,onBlur:this._handleSaveDraftText,onHeightChange:this._handleNavHeightChange,onPrimaryAction:this._handleSendMessage,onTyping:r?this._throttleSaveDraftText:this._handleTyping,prefillText:"string"==typeof y?y:void 0,primaryActionIcon:Oe,primaryActionLabel:ke,quickReplyOptions:p,ref:this._composer,removeMedia:u,richTextInputContext:h,scribeNamespace:m,typeaheadWrapper:b})}get _currentComposer(){return this._composer.current}_fetchConversation(e){var t;const{createLocalApiErrorHandler:a,fetchConversationHistoricalSnapshot:i,fetchConversationIfNeeded:n,location:r,updateConversationReadState:s}=this.props;var c;return null!=r&&null!=(t=r.state)&&t.entryPoint?(this.setState({hasLoadedSnapshot:!1}),i({conversationId:e,entryId:null==r||null==(c=r.state)?void 0:c.entryPoint}).then((e=>{var t,a;let i=!0;(null==e||null==(t=e.result)||null==(a=t.conversation_timeline)?void 0:a.status)===o.PAGINATION_STATUS.AT_END&&(i=!1),this.setState({hasLoadedSnapshot:!0,shouldScrollToCenter:i})})).catch((e=>(this.setState({hasLoadedSnapshot:!0}),a(e))))):n({conversationId:e}).then((()=>s(e))).catch(a(Object(A.a)(e)))}_requestWelcomeMessage(e){var t;const{addWelcomeMessageToConversation:a,conversation:i,createLocalApiErrorHandler:n,location:r}=this.props,{text:s}=r.query,c=Array.isArray(r.query.welcome_message_id)?r.query.welcome_message_id[0]:r.query.welcome_message_id,l=!!this.state.attachment||!(!s||c),d=!i||!i.type||i.type===o.CONVERSATION_TYPE.GROUP,p=i&&(null==i||null==(t=i.participants)?void 0:t.length)<=1;return l||d||p?Promise.resolve():a(e,c).catch(n({showToast:!1}))}}Be.contextType=G.a,Be.defaultProps={isNewGroupConversation:!1,typeaheadWrapper:B.a};t.a=Object(me.a)()(x(Be))},RJrc:function(e,t,a){"use strict";var i=a("ERkP"),n=a.n(i),r=a("3XMw"),s=a.n(r),o=a("MWbm"),c=a("Qwev"),l=a("rHpw");const d=s.a.ffde2fdb,p=l.a.create((e=>({spinner:{alignItems:"center",marginVertical:"30px"}})));t.a=()=>n.a.createElement(o.a,{style:p.spinner},n.a.createElement(c.a,{accessibilityLabel:d}))},"V/6K":function(e,t,a){"use strict";var i=a("ERkP");const n=a.n(i).a.createContext({isDrawer:!1});t.a=n},"X/yg":function(e,t,a){"use strict";a.d(t,"o",(function(){return c})),a.d(t,"n",(function(){return l})),a.d(t,"m",(function(){return d})),a.d(t,"c",(function(){return p})),a.d(t,"d",(function(){return u})),a.d(t,"i",(function(){return h})),a.d(t,"k",(function(){return m})),a.d(t,"l",(function(){return b})),a.d(t,"g",(function(){return g})),a.d(t,"j",(function(){return v})),a.d(t,"h",(function(){return y})),a.d(t,"f",(function(){return f})),a.d(t,"a",(function(){return _})),a.d(t,"b",(function(){return E})),a.d(t,"e",(function(){return C}));var i=a("CDB5"),n=a("Myq3"),r=a("XnpN"),s=a("AQ79"),o=a("pHkl");const c=(e,t)=>t.location&&t.location.state&&t.location.state.tweetAttachment,l=(e,t)=>t.location&&t.location.state&&t.location.state.participants,d=(e,t)=>t.location&&t.location.state&&t.location.state.isNewGroupConversation,p=e=>{const{message_data:t}=e;let a=o.f.UNKNOWN;const i=t&&t.attachment||{};return i.tweet?a=o.f.TWEET:i.photo?a=o.f.PHOTO:i.animated_gif?a=o.f.GIF:i.video?a=i.video.audio_only?o.f.VOICE:o.f.VIDEO:i.card?a=o.f.CARD:null!=t&&t.text&&(a=o.f.TEXT),a};function u(e,t){return e.findIndex((e=>e.id===t))}function h(e){return e===s.d.SECONDARY?o.e.REQUESTS:e===s.d.TERTIARY?o.e.LOW_QUALITY:o.e.PRIMARY}function m(e){return e.isTrue("dm_voice_rendering_enabled")}function b(e,t){return!!(e&&e.video&&m(t))&&!!e.video.audio_only}function g(e,t,a,i){return{pathname:`/i/report/dm_conversation/${e}`,state:{clientReferer:t,inboxType:i,scribeNamespace:a}}}function v(e,t){if(!e)return{name:"",screenName:"",idStr:""};const a=Object(r.a)(e,t).map((({user:e})=>e)),i=a&&a[0];return{name:i&&i.name||"",screenName:i&&i.screen_name||"",idStr:i&&i.id_str||""}}const y=e=>e===s.d.TERTIARY?"low_quality_timeline":e===s.d.SECONDARY?"requests_timeline":"inbox_timeline",f=e=>e===s.d.TERTIARY?"/messages/requests/additional":e===s.d.SECONDARY?"/messages/requests":"/messages",_=e=>()=>i.b(e),E=e=>t=>i.c(e,t),C=(e,t)=>{const a=Object(n.a)(e,(e=>!!e.message_data&&(e.message_data&&e.message_data.recipient_id===t)));return a&&a.message_data&&a.message_data.quick_reply&&a.message_data.quick_reply&&"options"===a.message_data.quick_reply.type?a.message_data.quick_reply:void 0}},XnpN:function(e,t,a){"use strict";a("kYxP");var i=a("aWyx"),n=a("t0aI");const r=(e=0)=>new Date(Number(e)),s=(e,t)=>r(e.join_time)-r(t.join_time),o=({user:e},{user:t})=>Object(n.a)(e.id_str,t.id_str);var c=a("VIKJ");t.a=(e,t)=>{const{created_by_user_id:a,participants:n,type:r}=e,[l,d]=Object(c.a)(n,(({user:e})=>e.id_str===t));return d.length?r===i.a.GROUP&&1===d.length?[...l,...d]:a?d.sort(((...e)=>(t,a)=>e.map((e=>e(t,a))).filter((e=>!!e))[0]||0)((e=>({user:t},{user:a})=>{switch(e){case t.id_str:return-1;case a.id_str:return 1;default:return 0}})(a),s,o)):d:l}},Yatk:function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));const i=e=>{if(e)return{blocking:e.blocking,can_dm:e.can_dm,can_media_tag:e.can_media_tag,created_at:e.created_at,description:e.description,entities:e.entities,followed_by:e.followed_by,followers_count:e.followers_count,following:e.following,friends_count:e.friends_count,id:e.id,id_str:e.id_str,name:e.name,profile_image_url_https:e.profile_image_url_https,protected:e.protected,screen_name:e.screen_name,verified:e.verified}}},aA19:function(e,t,a){"use strict";var i=a("ERkP"),n=a.n(i),r=a("aWyx"),s=a("XnpN"),o=a("3XMw"),c=a.n(o),l=a("aI6n"),d=a("rHpw"),p=a("TIdA"),u=a("A91F"),h=a("jhWN"),m=a("9Xij"),b=a("Znyr"),g=a("cm6r"),v=a("U+bB"),y=a("MWbm");const f=c.a.fd48249b,_=d.a.create((e=>({circle:{borderRadius:e.borderRadii.infinite,overflow:"hidden"},container:{height:"auto",width:"100%"},itemAccessory:{top:-e.spacesPx.space24+e.spacesPx.space1,right:-e.spacesPx.space16-e.spacesPx.space1},userDecoration:{fontSize:e.fontSizes.subtext3,position:"absolute",backgroundColor:e.colors.gray100,marginLeft:e.spaces.space8,boxSizing:"border-box",width:e.spaces.space24,height:e.spaces.space24}}))),E=d.a.create((e=>({container:{flexDirection:"row"},left:{flex:1},right:{flex:1,marginLeft:e.borderWidths.small,marginRight:`calc(-1 * ${e.borderWidths.small})`}}))),C=d.a.create((e=>({container:{flexDirection:"column"},top:{flex:1,marginBottom:e.borderWidths.small},bottom:{flex:1}}))),S=({left:e,right:t})=>n.a.createElement(y.a,{style:E.container},n.a.createElement(y.a,{style:E.left},e),n.a.createElement(y.a,{style:E.right},t)),R=({bottom:e,top:t})=>n.a.createElement(y.a,{style:C.container},n.a.createElement(y.a,{style:C.top},t),n.a.createElement(y.a,{style:C.bottom},e));t.a=e=>{const t=t=>{const{size:a}=e;return n.a.createElement(y.a,{key:t.id_str,style:_.container},n.a.createElement(h.a,{size:a||"xxLarge",uri:t.profile_image_url_https}))},a=e=>{const t=e.length,a=e.map(((e,a)=>{const i=2===t||3===t&&0===a?.5:1;return n.a.createElement(y.a,{key:e.id_str,style:_.container},n.a.createElement(h.a,{aspectRatio:i,shape:"none",size:"custom",uri:e.profile_image_url_https}))}));if(2===t)return n.a.createElement(m.a,{ratio:1},n.a.createElement(S,{left:a[1],right:a[0]}));{const e=n.a.createElement(R,{bottom:a[2],top:a[1]}),t=a[0];return n.a.createElement(S,{left:e,right:t})}},{conversation:i,link:o,perspective:c,withBadge:E}=e,C=i&&i.avatar_image_https,x=i?Object(s.a)(i,c).map((({user:e})=>e)):[],A=x.slice(0,3),w=(e=>{const t=e&&e.avatar&&e.avatar.image&&e.avatar.image.original_info;return t?n.a.createElement(p.a,{accessibilityLabel:"",aspectMode:u.a.SQUARE,backgroundColor:d.a.theme.colors.gray50,image:t,rounded:!0}):null})(i)||(e=>e?n.a.createElement(v.a,{source:e}):null)(C)||(e=>{const i=e.length;return 0===i?null:1===i?t(e[0]):n.a.createElement(y.a,{style:_.circle},a(e))})(A),T=o||((e,t)=>{if(e)return e.type===r.a.GROUP?`/messages/${e.conversation_id}/participants`:e.type===r.a.ONE_TO_ONE?`/${t[0].screen_name}`:void 0})(i,x),I=E&&null!=i&&i.participants?i.participants.length-1:0;return w?n.a.createElement(n.a.Fragment,null,n.a.createElement(m.a,{ratio:1},T?n.a.createElement(g.a,{interactiveStyles:null,link:T,testID:l.a.conversationAvatar},w):w),I?(({badgeCount:e})=>n.a.createElement(y.a,{style:_.itemAccessory},n.a.createElement(b.a,{count:e,standalone:!0,style:_.userDecoration,textColor:"text",truncatedCountFormatter:()=>"",unreadCountLabel:f,withTruncatedCount:!1})))({badgeCount:I}):null):null}},aI6n:function(e,t,a){"use strict";t.a={conversationAvatar:"DM_Conversation_Avatar",newDM:"NewDM_Button",untrustedThumbnail:"DM_Untrusted_Thumbnail"}},b9JY:function(e,t,a){"use strict";a.d(t,"b",(function(){return n})),a.d(t,"e",(function(){return r})),a.d(t,"d",(function(){return s})),a.d(t,"c",(function(){return o})),a.d(t,"a",(function(){return l}));var i=a("aWyx");const n=e=>e&&e.type===i.b.MESSAGE,r=e=>e&&e.type===i.b.WELCOME_MESSAGE,s=e=>e&&e.type===i.b.TRUST_CONVERSATION,o=e=>e&&e.type===i.b.REACTION_CREATE,c=[i.b.CONVERSATION_AVATAR_UPDATE,i.b.CONVERSATION_NAME_UPDATE,i.b.JOIN_CONVERSATION,i.b.PARTICIPANTS_JOIN,i.b.PARTICIPANTS_LEAVE],l=e=>e&&c.indexOf(e.type)>-1},"ejT/":function(e,t,a){"use strict";a.d(t,"b",(function(){return i})),a.d(t,"a",(function(){return n}));const i=e=>({id:e,distanceToViewportTop:0}),n=e=>({id:e,distanceToViewportBottom:0})},g54k:function(e,t,a){"use strict";a.d(t,"b",(function(){return c}));var i=a("hqKg"),n=a("s1N3");var r=e=>{const{sender_id:t,by_user_id:a,participants:i=[]}=e;return Object(n.a)(i.map((({user_id:e})=>e)).concat([t,a]).filter(Boolean))},s=a("G6rE"),o=a("oEGd");const c=(e,t)=>({users:r(t).reduce(((t,a)=>(t[a]=e[a],t)),{})}),l=Object(i.createSelector)(s.e.selectAll,((e,t)=>t.entry),c);t.a=Object(o.c)(l)},gbD7:function(e,t,a){"use strict";a.d(t,"b",(function(){return r})),a.d(t,"a",(function(){return s})),a.d(t,"d",(function(){return o})),a.d(t,"c",(function(){return c}));a("ERkP");var i=a("aWyx");const n=(e,t)=>({entry:{id:t,time:"",type:e},isActive:!1,isRapidFire:!1,isFirstRapidFire:!1,isLastRapidFire:!1,type:e}),r=n(i.b.CONVERSATION_PROFILE_INFO_HEADER,"conversationProfileInfoHeader"),s="typingIndicator",o=n(i.b.TYPING_INDICATOR,s),c=n(i.b.READ_ONLY_INDICATOR,"readOnlyIndicator")},htvZ:function(e,t,a){"use strict";a.d(t,"b",(function(){return v})),a.d(t,"a",(function(){return y}));var i=a("ERkP"),n=a.n(i),r=a("v6aA"),s=(a("kYxP"),a("8W85"));function o(){const e=n.a.useContext(y),[t,a]=e.activeVoiceMessage,[,i]=e.playerApi,[,r]=e.playerState,[,o]=t;const c={media:o,onEnded:function(){a([null,null]),e.scribeAction&&e.scribeAction.complete()},onPlayerApi:i,onPlayerState:r};return n.a.createElement(s.a,c)}var c=a("X/yg"),l=(a("849X"),a("89tF")),d=a("k89r");function p(e){const t=function(){const e=n.a.useState(m.activeVoiceMessage),t=n.a.useState(m.playerApi),a=n.a.useState(m.playerState),i=function(){const e=Object(d.a)();return n.a.useMemo((()=>{const t={page:"messages",section:"thread",component:"message",element:"voice"};function a({action:e,component:a=t.component}){const{element:i,page:n,section:r}=t;return{page:n,section:r,component:a,element:i,action:e}}const i=(t,i)=>i?i.data?e.scribe({...a({action:t}),data:i.data}):e.scribe({...a({action:t,component:h(i)})}):e.scribe({...a({action:t})});return{impression:e=>i("impression",e),report:e=>i("report",e),play:e=>i("play",e),pause:()=>i("pause"),complete:()=>i("complete")}}),[e])}();return{activeVoiceMessage:e,playerApi:t,playerState:a,scribeAction:i}}();return n.a.createElement(b.Provider,{value:t},e.children)}const u={Timelines:Object(l.a)({message:!0,inbox_timeline:!0,low_quality_timeline:!0,requests_timeline:!0})};function h({isLowQuality:e,isTrusted:t}){return t?u.Timelines.inbox_timeline:e?u.Timelines.low_quality_timeline:u.Timelines.requests_timeline}const m={activeVoiceMessage:[null,null],playerApi:null,playerState:null,scribeAction:null},b=n.a.createContext({activeVoiceMessage:[m.activeVoiceMessage,g],playerApi:[m.playerApi,g],playerState:[m.playerState,g],scribeAction:null});function g(){throw new Error("DMVoiceContext is not initialized")}function v(e){const{featureSwitches:t}=n.a.useContext(r.a);return Object(c.k)(t)?n.a.createElement(p,null,e.children,n.a.createElement(o,null)):e.children}const y=b},p9G8:function(e,t,a){"use strict";a.d(t,"b",(function(){return p}));a("kYxP");var i=a("Xrkv"),n=a("aWyx"),r=a("XnpN"),s=a("3XMw"),o=a.n(s);const c=o.a.b5b7fb93,l=o.a.g755fcde,d=o.a.f6b1ff81;t.a=(e,t,a)=>{const{type:i,name:s,participants:o={}}=e;if(i===n.a.GROUP&&s)return s;if(!o.length)return;if(i===n.a.GROUP&&a)return c;const l=Object(r.a)(e,t).map((({user:e})=>e));return p(l,t,i)};const p=(e=[],t,a=n.a.GROUP)=>{const r=e.filter((e=>e.id_str!==t)).map((e=>e.name));switch(r.length){case 0:return l;case 1:{const[e]=r;return a===n.a.GROUP?d({name:e}):e}default:{const e=!0;return Object(i.a)(r,e)}}}},prG5:function(e,t,a){"use strict";a.d(t,"a",(function(){return m}));var i=a("97Jx"),n=a.n(i),r=(a("kYxP"),a("ERkP")),s=a.n(r),o=a("nT9l"),c=a("3XMw"),l=a.n(c),d="image",p=a("TIdA"),u=a("a6qo");const h=l.a.f93bb3ee;class m extends s.a.Component{constructor(...e){super(...e),this._renderContent=({resourceSelectionHandler:e,useMinimumData:t})=>{const{accessibilityLabel:a,hideAcceptOverlay:i,shouldShowAltLabel:r,...o}=this.props;return s.a.createElement(s.a.Fragment,null,s.a.createElement(p.a,n()({},o,{accessibilityLabel:a,onVariantSelection:e,previewMode:t,testID:d})),r?s.a.createElement(u.a,{align:"left",altLabel:a}):null)}}render(){const{hideAcceptOverlay:e,image:t}=this.props;return s.a.createElement(o.a,{acceptLabel:h,hideAcceptOverlay:e,renderContent:this._renderContent,resourceId:"string"==typeof t?t:t.url})}}},"s8G+":function(e,t,a){"use strict";var i=a("ERkP"),n=a.n(i),r=a("v6aA");t.a=e=>{const{featureSwitches:t}=n.a.useContext(r.a);return n.a.useMemo((()=>t.isTrue(e)),[e,t])}},sl05:function(e,t,a){"use strict";var i=a("rHpw");t.a=i.a.create((e=>({root:{flexGrow:1},activity:{flexBasis:e.spacesPx.space1,flexGrow:1,height:"100%"},kaiOSFix:{paddingBottom:e.spaces.space20},dragDrop:{flexGrow:1},scrollView:{flexGrow:1}})))},tZH3:function(e,t,a){"use strict";var i=a("ERkP"),n=a.n(i),r=a("3XMw"),s=a.n(r),o=a("MWbm"),c=a("CKsB"),l=a("/yvb"),d=a("rHpw"),p=a("hiGS"),u=a("pu5c"),h=a("zIWA");const m=s.a.fcd4d489,b=s.a.gbed8594,g=s.a.g9074da4,v=s.a.ad63377d,y=s.a.h09b49f7,f=s.a.i6b19b07,_=s.a.j7bb1a42,E=s.a.ea200ba6,C=s.a.cfd2f35d,S=({dismiss:e,flatBorders:t,isGroup:a,onBlockClick:i,onDeleteClick:r,onReportClick:s,requestorScreenName:d,showBlock:S,showCancel:x,showDelete:A})=>{const w=n.a.useCallback((()=>{s&&s(),e()}),[e,s]),T=n.a.useCallback((()=>{i&&i(),e()}),[e,i]),I=n.a.useCallback((()=>{r&&r(),e()}),[e,r]);return n.a.createElement(o.a,{accessibilityRole:"dialog",style:t?R.flatCorners:R.roundCorners},A?n.a.createElement(c.a,{Icon:p.a,actionSubText:y,actionText:a?g:v,onClick:I,textColor:"red500"}):null,S?n.a.createElement(c.a,{Icon:u.a,actionSubText:b,actionText:m({screenName:d}),onClick:T}):null,n.a.createElement(c.a,{Icon:h.a,actionSubText:E,actionText:a?f:_({screenName:d}),onClick:w}),x?n.a.createElement(l.a,{onPress:e,style:R.cancelButton,type:"primaryOutlined"},C):null)};S.defaultProps={isGroup:!1,flatBorders:!1,showBlock:!1,showCancel:!1,showDelete:!1};const R=d.a.create((e=>({roundCorners:{borderRadius:e.borderRadii.xLarge},flatCorners:{borderRadius:e.borderRadii.none},cancelButton:{marginHorizontal:e.spaces.space16,marginVertical:e.spaces.space16}})));t.a=S},uB9N:function(e,t,a){"use strict";var i=a("97Jx"),n=a.n(i),r=a("ERkP"),s=a.n(r),o=a("1YZw"),c=a("zh9S"),l=a("P1r1"),d=a("AspN"),p=a("rxPX"),u=Object(p.a)().propsFromState((()=>({dataSaverMode:l.j}))).propsFromActions((()=>({addMedia:d.b,addToast:o.b,processMultipleMedia:d.g,removeMediaUpload:d.i,scribeAction:c.c,preUploadMedia:d.e}))),h=a("wpu3"),m=a("cOB2"),b=a("MWbm"),g=a("0FVZ"),v=a("Oe3h"),y=a("rHpw");var f=function(e){const{accessibilityLabel:t,accessibilityRole:a,children:i,onLayout:r,sideNavPresent:o,style:c}=e,l=s.a.useContext(m.a);return o?s.a.createElement(s.a.Fragment,null,s.a.createElement(b.a,{accessibilityLabel:t,accessibilityRole:a,onLayout:r,style:c},i)):s.a.createElement(g.a.BottomComposer,null,s.a.createElement(v.a,{id:"DMComposerWrapper"},((e,o)=>s.a.createElement(b.a,n()({ref:e()},o({accessibilityLabel:t,accessibilityRole:a,onLayout:r,style:c})),i,s.a.createElement(b.a,{style:!1===l.keyboardVisible&&_.offsetBottom})))))};const _=y.a.create((()=>({offsetBottom:{paddingBottom:y.a.iPhoneOffsetBottom}})));a("kYxP");var E=a("HPNB"),C=a("htQn"),S=a("t62R");class R extends s.a.Component{constructor(...e){super(...e),this._handleClick=()=>{const{id:e,label:t,onClick:a}=this.props;a({id:e,label:t})}}render(){const{description:e,isWide:t,label:a}=this.props;return s.a.createElement(C.a,{accessibilityRole:"button",onClick:this._handleClick,style:[x.root,t&&x.isWide,!t&&x.isNarrow]},s.a.createElement(S.b,{weight:"bold"},a),s.a.createElement(S.b,{color:"gray700",size:"subtext2"},e))}}const x=y.a.create((e=>({root:{backgroundColor:e.colors.cellBackground,borderColor:e.colors.borderColor,borderStyle:"solid",paddingLeft:"1rem",paddingVertical:"1rem"},isWide:{borderRadius:e.borderRadii.xLarge,paddingVertical:"0.5rem",borderWidth:e.borderWidths.small},isNarrow:{borderTopWidth:e.borderWidths.small}})));var A=R,w=a("cHvH"),T=a("mw9i");class I extends s.a.Component{constructor(...e){super(...e),this._handleOptionChoose=e=>{const{onOptionChoose:t,quickReplyOptions:{id:a}}=this.props;return t(a,e)}}render(){const{quickReplyOptions:{options:e}}=this.props,t=1===e.length;return s.a.createElement(w.a,null,(({windowWidth:a})=>{const i=E.a.isTwoColumnLayout(a),n=[i&&O.isWide,i&&t&&O.oneButtonOnly,!i&&O.isNarrow];return s.a.createElement(T.a,{style:n,withGutter:i},e.map((e=>this.renderOption(e,i))))}))}renderOption(e,t){return s.a.createElement(A,{description:e.description,id:e.id,isWide:t,key:e.id,label:e.label,onClick:this._handleOptionChoose})}}const O=y.a.create((e=>({oneButtonOnly:{gridTemplateColumns:"1fr"},isWide:{backgroundColor:e.colors.gray0,display:"grid",gridColumnGap:e.spaces.space12,gridRowGap:e.spaces.space12,gridTemplateColumns:"1fr 1fr",paddingVertical:e.spaces.space12},isNarrow:{maxHeight:"168px",overflow:"auto"}})));var M=I,k=a("krmn"),D=a("cIoY"),P=a("w3n3"),L=a("MLl7"),F=a("3XMw"),B=a.n(F),N=a("J2UM"),j=a("VPdC"),U=a("pKoL"),H=a("eyty"),W=a("oQhu"),V=a("JYMr");const z=[{waitMs:1e3,progress:.1},{waitMs:1400,progress:.3},{waitMs:1800,progress:.5},{waitMs:2400,progress:.6},{waitMs:3e3,progress:.9}];class q extends s.a.Component{constructor(...e){super(...e),this.state={currentStepIndex:-1}}componentDidMount(){this._scheduleNextStep(0)}componentWillUnmount(){this._currentTimeoutId&&clearTimeout(this._currentTimeoutId)}render(){const{currentStepIndex:e}=this.state,t=e>=0&&e<z.length?z[e].progress:0;return s.a.createElement(V.a,{progress:t})}_scheduleNextStep(e){e<z.length&&(this._currentTimeoutId=setTimeout((()=>{this._currentTimeoutId=void 0,this.setState({currentStepIndex:e}),this._scheduleNextStep(e+1)}),z[e].waitMs))}}function G({isSending:e,isUploading:t,progress:a}){return e&&!t?s.a.createElement(q,null):s.a.createElement(V.a,{progress:e?Math.max(a,.02):0})}var Y=s.a.memo(G),Q=a("Dtul"),$=a("Es6L"),K="dmComposerAttachments",X="dmComposerTextInput",J="dmComposerSendButton",Z=a("GZwR"),ee=a("aITJ"),te=a("6OUF"),ae=a("9Xij"),ie=a("/yvb"),ne=a("OiMc"),re=a("v6aA"),se=a("gpVt"),oe=a("Lsrn"),ce=a("k/Ka");const le=(e={})=>Object(ce.a)("svg",{...e,accessibilityHidden:void 0===e.accessibilityLabel,style:[oe.a.root,e.style],viewBox:"0 0 24 24"},s.a.createElement("g",null,s.a.createElement("path",{d:"M19 13.5H5c-.828 0-1.5-.672-1.5-1.5s.672-1.5 1.5-1.5h14c.828 0 1.5.672 1.5 1.5s-.672 1.5-1.5 1.5zm0 6H5c-.828 0-1.5-.672-1.5-1.5s.672-1.5 1.5-1.5h14c.828 0 1.5.672 1.5 1.5s-.672 1.5-1.5 1.5zm0-12H5c-.828 0-1.5-.672-1.5-1.5S4.172 4.5 5 4.5h14c.828 0 1.5.672 1.5 1.5s-.672 1.5-1.5 1.5z"})));le.metadata={width:24,height:24};var de=le;const pe=(e={})=>Object(ce.a)("svg",{...e,accessibilityHidden:void 0===e.accessibilityLabel,style:[oe.a.root,e.style],viewBox:"0 0 24 24"},s.a.createElement("g",null,s.a.createElement("path",{d:"M19 13H5c-.553 0-1-.447-1-1s.447-1 1-1h14c.553 0 1 .447 1 1s-.447 1-1 1zm0 6H5c-.553 0-1-.447-1-1s.447-1 1-1h14c.553 0 1 .447 1 1s-.447 1-1 1zm0-12H5c-.553 0-1-.447-1-1s.447-1 1-1h14c.553 0 1 .447 1 1s-.447 1-1 1z"})));pe.metadata={width:24,height:24};var ue=pe,he=a("iySH");const me=B.a.ee230734,be=B.a.ca0ce0e4,ge=B.a.cdcebd22,ve=B.a.ic8c615d,ye=B.a.a04077c4,fe=e=>!(!e||!e.media),_e=Object(h.b)({maxNumberOfPhotos:1});class Ee extends s.a.Component{constructor(e,t){var a;super(e,t),this._handleLayout=e=>{const{onHeightChange:t}=this.props,{mediaButtonsCollapsible:a}=this.state,i=e.nativeEvent.layout;i&&(Object($.a)()||t&&t(i.height),i.width<=y.a.theme.breakpoints.small&&!a?this.setState({mediaButtonsCollapsible:!0}):i.width>y.a.theme.breakpoints.small&&a&&this.setState({mediaButtonsCollapsible:!1}))},this._renderQuickReplyPicker=()=>{const{quickReplyOptions:e}=this.props,{isQuickReplyOpen:t}=this.state;return e&&t?s.a.createElement(M,{onOptionChoose:this._handleQROptionSelection,quickReplyOptions:e}):null},this._renderComposeBox=()=>s.a.createElement(b.a,{style:Ce.composeBoxContainer},this._renderMainContent()),this._renderMainContent=()=>{const{richTextInputContext:e,typeaheadWrapper:t}=this.props,{value:a}=this.state,i=t;return i?s.a.createElement(i,{contextText:a,isInline:!0,onTextUpdated:e?this._handleRichTextChange:this._handlePlainTextChange,onTypeaheadStateChange:this._handleTypeaheadStateChange,source:Z.d.ComposeMessage},this._renderFieldTextInput):this._renderFieldTextInput()},this._renderFieldTextInput=e=>{const{disabled:t,placeholderText:a,richTextInputContext:i}=this.props,r=ee.b.isKaiOS()?ge:a||be,{editorState:o,mediaButtonsCollapsible:c,value:l}=this.state,d=!!i,p=i?{editorState:o,element:i.element}:void 0,u=i?{onChange:this._getHandleRichTextChange(e),richTextInputContext:{editorState:o,element:i.element}}:{onChange:this._getHandlePlainTextChange(e),richTextInputContext:void 0};return s.a.createElement(te.a,n()({contentAbove:this._renderAttachments(),editable:!t,emojiPickerButton:this._renderEmojiPicker(),handleReturn:d?this._handleReturn:void 0,isCompact:!0,leftAligned:!0,maxNumberOfLines:d?8:4,multiline:!0,numberOfLines:1,onBlur:this._handleOnBlur,onFilesAdded:this._handleAddMediaFiles,onFocus:this._handleTextInputFocus,onKeyPress:d?void 0:this._handleReturn,placeholder:r,ref:this._setTextInputRef,richTextInputContext:t?void 0:p,style:Ce.composeInput,testID:X,useCacheForDOMMeasurements:!this._isSendDisabled()&&!c,value:l},u))},this._getHandleRichTextChange=Object(W.a)((e=>t=>{null==e||e(t),this._handleRichTextChange(t)})),this._getHandlePlainTextChange=Object(W.a)((e=>t=>{null==e||e(t),this._handlePlainTextChange(t)})),this._handleTypeaheadStateChange=e=>{this.setState({isTypeaheadActive:e})},this._renderAttachments=()=>{const{attachment:e,conversationId:t,isCardPreviewTombstoned:a,isShareViaDM:i,isUploading:n}=this.props,{value:r}=this.state,{height:o,width:c}=e&&(e.media&&e.media.mediaFile||e.provider&&e.media&&e.media.externalMediaDetails)||{},l=null==e?void 0:e.media,d=null==l?void 0:l.mediaMetadata,p=null==d?void 0:d.altText,u=null==d?void 0:d.defaultAltText,h=Object(se.b)(r);return s.a.createElement(s.a.Fragment,null,l?s.a.createElement(b.a,{style:Ce.attachmentContainer,testID:K},s.a.createElement(ae.a,{ratio:c/o,style:Ce.aspectContainer},s.a.createElement(b.a,{style:Ce.mediaPreviewContainer},s.a.createElement(U.a,{accessibilityLabel:p||u,mediaItem:l,onClick:this._canEditImage?this._handleClickMediaDetail:void 0,onEdit:this._canEditImage||this._canEditVideo?this._handleClickMediaDetail:void 0,onRemove:this._handleRemoveMedia(l.id),resizeIfNeeded:"width",style:Ce.mediaPreview,withAltTextLabel:!!p,withCloseButton:!n,withEditButton:(this._canEditImage||this._canEditVideo)&&!n,withEditIcon:!0}))),e&&e.provider&&e.gifUrl&&s.a.createElement(b.a,{style:Ce.gifAttribution},s.a.createElement(D.a,{gifUrl:e.gifUrl,provider:e.provider}))):h&&!i?s.a.createElement(se.a,{conversationId:t,isCardPreviewTombstoned:a,style:Ce.cardPreviewContainer,urls:h}):null)},this._renderEmojiPicker=()=>{const{withEmojiPicker:e}=this.props;return e&&ee.b.isDesktopOS()?s.a.createElement(k.a,{disabled:this.props.disabled,onEmojiSelect:this._handleEmojiSelect,onPress:this._handleTextInputFocus,size:"small",textInputRef:this._textInput||void 0}):null},this._renderPrimaryActionButton=e=>{const{primaryActionIcon:t,primaryActionLabel:a,quickReplyOptions:i}=this.props,n=this._hasMessageText();return!i||n||e?s.a.createElement(ie.a,{accessibilityLabel:a,disabled:this._isSendDisabled(),hoverLabel:{label:a},icon:t||void 0,onPress:this._handlePrimaryAction,size:"medium",style:Ce.actionButton,testID:J,type:t?"brandText":"brandFilled"},t?null:a):this._renderQRToggleButton()},this._renderSecondaryActionButton=()=>{const{secondaryActionDisabledPopoverRenderer:e,secondaryActionLabel:t,shouldEnableSecondaryActionFunc:a,shouldShowSecondaryActionFunc:i}=this.props;if(i&&!i()||!t)return null;const n=!a||a(),r=s.a.createElement(ie.a,{accessibilityLabel:t,disabled:!n,onPress:this._handleSecondaryAction,style:Ce.actionButton,type:"primaryOutlined"},this.props.secondaryActionLabel);return n||!e?r:s.a.createElement(ne.a,{enableHover:!0,preferredVerticalOrientation:"up",renderContent:e,withArrow:!0},r)},this._renderQRToggleButton=()=>{const{isQuickReplyOpen:e}=this.state;return s.a.createElement(ie.a,{accessibilityLabel:ve,icon:e?s.a.createElement(de,null):s.a.createElement(ue,null),onPress:this._handleQuickReplyPickerToggle,size:"medium",style:Ce.actionButton,type:"brandText"})},this._renderComposer=()=>{const{attachment:e}=this.props,t=fe(e),a=this._renderComposeBox(),i=this._renderPrimaryActionButton(t),n=this._renderSecondaryActionButton();return s.a.createElement(b.a,{style:[Ce.composer,t&&Ce.composerWithAttachment]},t?null:this._renderMediaButtons(),a,n,i)},this._renderMediaButtons=()=>{const{withGifPicker:e,withMediaPicker:t}=this.props,{mediaButtonsCollapsed:a,mediaButtonsCollapsible:i}=this.state,n=i&&a;return s.a.createElement(b.a,{style:Ce.uploadButtons},n?s.a.createElement(ie.a,{accessibilityLabel:me,icon:s.a.createElement(he.a,null),onMouseDown:this._handleShowMediaControlsMouseDown,type:"brandText"}):null,t&&!n?this._renderMediaPicker():null,e&&!n?this._renderGifButton():null)},this._handleShowMediaControlsMouseDown=()=>{const{scribeAction:e,scribeNamespace:t}=this.props;this.setState({mediaButtonsCollapsed:!1}),e({...t,component:"dm_composer",element:"toggle",action:"expand"})},this._handleReturn=e=>{const{nativeEvent:{ctrlKey:t,key:a,metaKey:i,shiftKey:n}}=e,r="Enter"===a,{isTypeaheadActive:s}=this.state;return!s&&r&&this._keyboardOrMouseDetected&&!(n||i||t)?(e.preventDefault(),this._handlePrimaryAction(e),"handled"):"not-handled"},this._handleClickMediaDetail=()=>{const{attachment:e,conversationId:t,history:a}=this.props;if(this._canEditImage||this._canEditVideo){const i=e&&e.media?e.media.id:0,n=this._canEditVideo?"trimmer":"crop";a.push("/messages/compose/media",{mediaId:i,conversationId:t,tab:n})}},this._handleAddMediaFiles=e=>{const{addMedia:t,addToast:a,dataSaverMode:i,onAddMedia:n,preUploadMedia:r,processMultipleMedia:s,removeMedia:o,removeMediaUpload:c}=this.props;t(e,{location:H.d.Dm}).then((e=>{const t=e.map((e=>e.id));this._validateMedia(e)?(n&&n(t),s(e,{onFailure:o}).then((e=>{i||r(e.map((e=>e.id)))}))):(a({text:ye}),c(t))}))},this._handleEmojiSelect=e=>{const{editorState:t}=this.state,{richTextInputContext:a}=this.props;if(!a||!t)return;const i=a.insertTextAtCursor(t,e.text);this._handleRichTextChange(i)},this._handleRemoveMedia=e=>()=>{this.props.removeMedia&&this.props.removeMedia(e)},this._handlePrimaryAction=e=>{if(!this._isSendDisabled()){const{onPrimaryAction:e}=this.props;this._textInput&&this._textInput.applyFinalValue((t=>{e({type:"richText"},t)})),this._closeQuickReplyPicker()}},this._handleSecondaryAction=e=>{const{onSecondaryAction:t}=this.props;this._textInput&&this._textInput.applyFinalValue((e=>{t&&t({type:"richText"},e)}))},this._handleRichTextChange=e=>{const{onTyping:t,richTextInputContext:a}=this.props,{value:i}=this.state,n=e.getCurrentContent().getPlainText(),r=a?a.convertEmojiToEntities(e):null;this.setState({editorState:r,value:n}),i!==n&&(null==t||t())},this._handlePlainTextChange=e=>{const{onTyping:t}=this.props,{value:a}=this.state,i=e.target.value;this.setState({value:i}),a!==i&&(null==t||t())},this._handleOnBlur=()=>{const{onBlur:e}=this.props,{mediaButtonsCollapsible:t}=this.state;e&&e(),t&&this.setState({mediaButtonsCollapsed:!1})},this._handleTextInputFocus=()=>{const{quickReplyOptions:e}=this.props,{isQuickReplyOpen:t,mediaButtonsCollapsible:a}=this.state;e&&t&&this._closeQuickReplyPicker(),a&&this.setState({mediaButtonsCollapsed:!0})},this._handleQROptionSelection=(e,t)=>{const{disabled:a,onPrimaryAction:i}=this.props;a||(i({quickReply:{id:e,selected_id:t.id}},t.label),this._closeQuickReplyPicker())},this._handleQuickReplyPickerToggle=()=>{this.setState({isQuickReplyOpen:!this.state.isQuickReplyOpen})},this._validateMedia=e=>!fe(this.props.attachment)&&_e(e),this._detectKeyboardOrMouse=e=>{const{KEYBOARD:t,MOUSE:a,registerSome:i}=e;i((()=>{this._keyboardOrMouseDetected=!0}),[t,a])},this._isSendDisabled=()=>{const{attachment:e,canSendEmptyMessage:t,disabled:a,isUploading:i}=this.props,n=fe(e),r=this._hasMessageText()||t,s=!(!e||!e.media)&&(e.media.needsProcessing||i);return a||!r&&!n||s||i},this._hasMessageText=()=>!!(this.state.value||"").trim(),this._closeQuickReplyPicker=()=>{this.setState({isQuickReplyOpen:!1})},this.handleAddMediaFiles=e=>this._handleAddMediaFiles(e),this._setTextInputRef=e=>{this._textInput=e};const{prefillText:i,richTextInputContext:r}=e;this.state={isQuickReplyOpen:!0,value:i,editorState:null!=(a=null==r||null==r.initEditorState?void 0:r.initEditorState(i))?a:null,isTypeaheadActive:!1,mediaButtonsCollapsed:!1,mediaButtonsCollapsible:!1}}componentDidMount(){Object(N.a)().then(this._detectKeyboardOrMouse),this._unlockReload=Q.a.acquire()}componentWillUnmount(){this._unlockReload&&this._unlockReload()}componentDidUpdate(){this.props.quickReplyOptions&&this.state.isQuickReplyOpen&&this._textInput&&this._textInput.blur()}UNSAFE_componentWillReceiveProps(e){const t=this.props.quickReplyOptions,a=e.quickReplyOptions;t&&!a?this.setState({isQuickReplyOpen:!1}):(!t&&a||t&&a&&t.id!==a.id)&&this.setState({isQuickReplyOpen:!0}),this.props.conversationId!==e.conversationId&&this.clear()}render(){const{dtabBarInfo:e,isSending:t,isUploading:a,mediaUploadProgress:i,placeholderText:n,style:r}=this.props,o=n||be,c=Object($.a)(),l=c&&e&&(e.dtabAll||e.ttsToken)&&!e.hide;return s.a.createElement(f,{accessibilityLabel:o,accessibilityRole:"complementary",onLayout:this._handleLayout,sideNavPresent:c,style:[Ce.root,l&&Ce.dtabOffset,r]},s.a.createElement(Y,{isSending:t,isUploading:a,progress:t?Math.max(i,.02):0}),this._renderComposer(),this._renderQuickReplyPicker())}_renderMediaPicker(){return s.a.createElement(j.a,{onChange:this._handleAddMediaFiles,style:Ce.mediaPicker,type:"brandText"})}_renderGifButton(){const{conversationId:e,history:t}=this.props;return s.a.createElement(P.a,{dmConversationId:e,enabled:!0,gifSearchKeySource:L.a.DMComposition,history:t})}get _canEditImage(){var e,t,a;return!(null==(e=this.props.attachment)||null==(t=e.media)||null==(a=t.mediaFile)||!a.isImage)}get _canEditVideo(){var e,t;const{attachment:a}=this.props;let i=null==a||null==(e=a.media)||null==(t=e.mediaFile)?void 0:t.isVideo;return i&&(this._videoTrimmerEnabled=this.context.featureSwitches.isTrue("responsive_web_video_trimmer_enabled"),i=this._videoTrimmerEnabled),!!i}clear(){const{richTextInputContext:e}=this.props;if(e){const{initEditorState:t}=e||{};this.setState({value:"",editorState:t&&t("")})}else this.setState({value:""})}focus(){this._textInput&&this._textInput.focus()}value(){return this.state.value}}Ee.contextType=re.a,Ee.defaultProps={prefillText:"",withEmojiPicker:!0,withGifPicker:!0,withMediaPicker:!0};const Ce=y.a.create((e=>({root:{backgroundColor:e.colors.navigationBackground,borderTopColor:e.colors.borderColor,borderTopWidth:e.borderWidths.small},attachmentContainer:{maxHeight:"10rem",margin:e.spaces.space12},aspectContainer:{flexShrink:1},cardPreviewContainer:{margin:e.spaces.space12},dtabOffset:{marginBottom:e.spaces.space40},gifAttribution:{flexDirection:"row",marginVertical:e.spaces.space4,marginHorizontal:0},mediaPicker:{margin:0},icon:{color:e.colors.primary,fontSize:"1.5em"},composeBoxContainer:{flexGrow:1,flexShrink:1,alignSelf:"center"},composeInput:{width:"100%"},mediaPreviewContainer:{flexDirection:"row",height:"100%"},mediaPreview:{borderRadius:e.borderRadii.xLarge,overflow:"hidden",minWidth:"10em"},composer:{alignItems:"center",flexDirection:"row",padding:e.spaces.space4,width:"100%"},composerWithAttachment:{paddingLeft:e.spaces.space12},actionButton:{marginLeft:e.spaces.space4},uploadButtons:{flexDirection:"row",marginRight:e.spaces.space4}})));t.a=u.forwardRef(Ee)},zQEV:function(e,t,a){"use strict";a.d(t,"b",(function(){return h})),a.d(t,"a",(function(){return b}));var i=a("ERkP"),n=a.n(i),r=a("t62R"),s=a("aWyx"),o=a("3XMw"),c=a.n(o);const l=c.a.c1d4ac83,d=c.a.abc7b032,p=c.a.i263b293,u=({children:e,conversationId:t})=>n.a.createElement(r.b,{link:`/messages/${t}/participants`},e),h=(e,t)=>e>=2?n.a.createElement(c.a.I18NFormatMessage,{$i18n:"e3534476"},n.a.createElement(u,{conversationId:t},c.a.d1242bcc({count:e}))):n.a.createElement(c.a.I18NFormatMessage,{$i18n:"b6656850",count:e}),m=({entry:e,users:t})=>e.participants?n.a.createElement("span",null,e.participants.map((({user_id:e},a)=>{const i=t[e];return i?n.a.createElement("span",{key:a},a>0?", ":null,n.a.createElement(r.b,null,i.name)):null}))):null,b=(e,t,a,i)=>{const o=a===e.by_user_id;let u;switch(t){case s.b.CONVERSATION_AVATAR_UPDATE:return u=e.by_user_id&&i[e.by_user_id]&&i[e.by_user_id].name,u?o?l:(e=>n.a.createElement(c.a.I18NFormatMessage,{$i18n:"bff29c94"},n.a.createElement(r.b,null,e)))(u):d;case s.b.CONVERSATION_NAME_UPDATE:{const t=n.a.createElement(r.b,null,e.conversation_name);return u=e.by_user_id&&i[e.by_user_id]&&i[e.by_user_id].name,u?o?(e=>n.a.createElement(c.a.I18NFormatMessage,{$i18n:"b16e4d45"},e))(t):((e,t)=>n.a.createElement(c.a.I18NFormatMessage,{$i18n:"c5760698"},n.a.createElement(r.b,null,e),t))(u,t):(e=>n.a.createElement(c.a.I18NFormatMessage,{$i18n:"a72730a0"},e))(t)}case s.b.JOIN_CONVERSATION:return u=e.sender_id&&i[e.sender_id]&&i[e.sender_id].name,u?(e=>n.a.createElement(c.a.I18NFormatMessage,{$i18n:"fa95b019"},n.a.createElement(r.b,null,e)))(u):p;case s.b.PARTICIPANTS_LEAVE:return(e=>n.a.createElement(c.a.I18NFormatMessage,{$i18n:"fc10875e"},e))(n.a.createElement(m,{entry:e,users:i}));case s.b.PARTICIPANTS_JOIN:u=e.sender_id&&i[e.sender_id]&&i[e.sender_id].name;return((e,t)=>e?n.a.createElement(c.a.I18NFormatMessage,{$i18n:"a4bc88c2"},n.a.createElement(r.b,null,e),t):n.a.createElement(c.a.I18NFormatMessage,{$i18n:"bfdff0c3"},t))(u,n.a.createElement(m,{entry:e,users:i}));default:return""}}}}]);
//# sourceMappingURL=https://ton.local.twitter.com/responsive-web-internal/sourcemaps/client-web/shared~loader.DMDrawer~bundle.DMRichTextCompose.a47ee975.js.map